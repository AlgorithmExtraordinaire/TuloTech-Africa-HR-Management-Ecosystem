var Lr=Object.defineProperty;var Tt=e=>{throw TypeError(e)};var Mr=(e,t,r)=>t in e?Lr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var v=(e,t,r)=>Mr(e,typeof t!="symbol"?t+"":t,r),ot=(e,t,r)=>t.has(e)||Tt("Cannot "+r);var u=(e,t,r)=>(ot(e,t,"read from private field"),r?r.call(e):t.get(e)),w=(e,t,r)=>t.has(e)?Tt("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),_=(e,t,r,n)=>(ot(e,t,"write to private field"),n?n.call(e,r):t.set(e,r),r),S=(e,t,r)=>(ot(e,t,"access private method"),r);var Nt=(e,t,r,n)=>({set _(s){_(e,t,s,r)},get _(){return u(e,t,n)}});var tr={Stringify:1},F=(e,t)=>{const r=new String(e);return r.isEscaped=!0,r.callbacks=t,r},Hr=/[&<>'"]/,rr=async(e,t)=>{let r="";t||(t=[]);const n=await Promise.all(e);for(let s=n.length-1;r+=n[s],s--,!(s<0);s--){let a=n[s];typeof a=="object"&&t.push(...a.callbacks||[]);const i=a.isEscaped;if(a=await(typeof a=="object"?a.toString():a),typeof a=="object"&&t.push(...a.callbacks||[]),a.isEscaped??i)r+=a;else{const o=[r];te(a,o),r=o[0]}}return F(r,t)},te=(e,t)=>{const r=e.search(Hr);if(r===-1){t[0]+=e;return}let n,s,a=0;for(s=r;s<e.length;s++){switch(e.charCodeAt(s)){case 34:n="&quot;";break;case 39:n="&#39;";break;case 38:n="&amp;";break;case 60:n="&lt;";break;case 62:n="&gt;";break;default:continue}t[0]+=e.substring(a,s)+n,a=s+1}t[0]+=e.substring(a,s)},nr=e=>{const t=e.callbacks;if(!(t!=null&&t.length))return e;const r=[e],n={};return t.forEach(s=>s({phase:tr.Stringify,buffer:r,context:n})),r[0]},sr=async(e,t,r,n,s)=>{typeof e=="object"&&!(e instanceof String)&&(e instanceof Promise||(e=e.toString()),e instanceof Promise&&(e=await e));const a=e.callbacks;return a!=null&&a.length?(s?s[0]+=e:s=[e],Promise.all(a.map(o=>o({phase:t,buffer:s,context:n}))).then(o=>Promise.all(o.filter(Boolean).map(c=>sr(c,t,!1,n,s))).then(()=>s[0]))):Promise.resolve(e)},$r=(e,...t)=>{const r=[""];for(let n=0,s=e.length-1;n<s;n++){r[0]+=e[n];const a=Array.isArray(t[n])?t[n].flat(1/0):[t[n]];for(let i=0,o=a.length;i<o;i++){const c=a[i];if(typeof c=="string")te(c,r);else if(typeof c=="number")r[0]+=c;else{if(typeof c=="boolean"||c===null||c===void 0)continue;if(typeof c=="object"&&c.isEscaped)if(c.callbacks)r.unshift("",c);else{const l=c.toString();l instanceof Promise?r.unshift("",l):r[0]+=l}else c instanceof Promise?r.unshift("",c):te(c.toString(),r)}}}return r[0]+=e.at(-1),r.length===1?"callbacks"in r?F(nr(F(r[0],r.callbacks))):F(r[0]):rr(r,r.callbacks)},Rt=Symbol("RENDERER"),vt=Symbol("ERROR_HANDLER"),A=Symbol("STASH"),ar=Symbol("INTERNAL"),Br=Symbol("MEMO"),tt=Symbol("PERMALINK"),Dt=e=>(e[ar]=!0,e),ir=e=>({value:t,children:r})=>{if(!r)return;const n={children:[{tag:Dt(()=>{e.push(t)}),props:{}}]};Array.isArray(r)?n.children.push(...r.flat()):n.children.push(r),n.children.push({tag:Dt(()=>{e.pop()}),props:{}});const s={tag:"",props:n,type:""};return s[vt]=a=>{throw e.pop(),a},s},or=e=>{const t=[e],r=ir(t);return r.values=t,r.Provider=r,Re.push(r),r},Re=[],bt=e=>{const t=[e],r=(n=>{t.push(n.value);let s;try{s=n.children?(Array.isArray(n.children)?new dr("",{},n.children):n.children).toString():""}catch(a){throw t.pop(),a}return s instanceof Promise?s.finally(()=>t.pop()).then(a=>F(a,a.callbacks)):(t.pop(),F(s))});return r.values=t,r.Provider=r,r[Rt]=ir(t),Re.push(r),r},Se=e=>e.values.at(-1),Je={title:[],script:["src"],style:["data-href"],link:["href"],meta:["name","httpEquiv","charset","itemProp"]},gt={},Ke="data-precedence",He=e=>Array.isArray(e)?e:[e],Ct=new WeakMap,qt=(e,t,r,n)=>({buffer:s,context:a})=>{if(!s)return;const i=Ct.get(a)||{};Ct.set(a,i);const o=i[e]||(i[e]=[]);let c=!1;const l=Je[e];if(l.length>0){e:for(const[,d]of o)for(const f of l)if(((d==null?void 0:d[f])??null)===(r==null?void 0:r[f])){c=!0;break e}}if(c?s[0]=s[0].replaceAll(t,""):l.length>0?o.push([t,r,n]):o.unshift([t,r,n]),s[0].indexOf("</head>")!==-1){let d;if(n===void 0)d=o.map(([f])=>f);else{const f=[];d=o.map(([p,,h])=>{let y=f.indexOf(h);return y===-1&&(f.push(h),y=f.length-1),[p,y]}).sort((p,h)=>p[1]-h[1]).map(([p])=>p)}d.forEach(f=>{s[0]=s[0].replaceAll(f,"")}),s[0]=s[0].replace(/(?=<\/head>)/,d.join(""))}},$e=(e,t,r)=>F(new H(e,r,He(t??[])).toString()),Be=(e,t,r,n)=>{if("itemProp"in r)return $e(e,t,r);let{precedence:s,blocking:a,...i}=r;s=n?s??"":void 0,n&&(i[Ke]=s);const o=new H(e,i,He(t||[])).toString();return o instanceof Promise?o.then(c=>F(o,[...c.callbacks||[],qt(e,c,i,s)])):F(o,[qt(e,o,i,s)])},Ur=({children:e,...t})=>{const r=St();if(r){const n=Se(r);if(n==="svg"||n==="head")return new H("title",t,He(e??[]))}return Be("title",e,t,!1)},Wr=({children:e,...t})=>{const r=St();return["src","async"].some(n=>!t[n])||r&&Se(r)==="head"?$e("script",e,t):Be("script",e,t,!1)},zr=({children:e,...t})=>["href","precedence"].every(r=>r in t)?(t["data-href"]=t.href,delete t.href,Be("style",e,t,!0)):$e("style",e,t),Vr=({children:e,...t})=>["onLoad","onError"].some(r=>r in t)||t.rel==="stylesheet"&&(!("precedence"in t)||"disabled"in t)?$e("link",e,t):Be("link",e,t,"precedence"in t),Jr=({children:e,...t})=>{const r=St();return r&&Se(r)==="head"?$e("meta",e,t):Be("meta",e,t,!1)},cr=(e,{children:t,...r})=>new H(e,r,He(t??[])),Kr=e=>(typeof e.action=="function"&&(e.action=tt in e.action?e.action[tt]:void 0),cr("form",e)),lr=(e,t)=>(typeof t.formAction=="function"&&(t.formAction=tt in t.formAction?t.formAction[tt]:void 0),cr(e,t)),Yr=e=>lr("input",e),Gr=e=>lr("button",e);const ct=Object.freeze(Object.defineProperty({__proto__:null,button:Gr,form:Kr,input:Yr,link:Vr,meta:Jr,script:Wr,style:zr,title:Ur},Symbol.toStringTag,{value:"Module"}));var Xr=new Map([["className","class"],["htmlFor","for"],["crossOrigin","crossorigin"],["httpEquiv","http-equiv"],["itemProp","itemprop"],["fetchPriority","fetchpriority"],["noModule","nomodule"],["formAction","formaction"]]),rt=e=>Xr.get(e)||e,ur=(e,t)=>{for(const[r,n]of Object.entries(e)){const s=r[0]==="-"||!/[A-Z]/.test(r)?r:r.replace(/[A-Z]/g,a=>`-${a.toLowerCase()}`);t(s,n==null?null:typeof n=="number"?s.match(/^(?:a|border-im|column(?:-c|s)|flex(?:$|-[^b])|grid-(?:ar|[^a])|font-w|li|or|sca|st|ta|wido|z)|ty$/)?`${n}`:`${n}px`:n)}},De=void 0,St=()=>De,Zr=e=>/[A-Z]/.test(e)&&e.match(/^(?:al|basel|clip(?:Path|Rule)$|co|do|fill|fl|fo|gl|let|lig|i|marker[EMS]|o|pai|pointe|sh|st[or]|text[^L]|tr|u|ve|w)/)?e.replace(/([A-Z])/g,"-$1").toLowerCase():e,Qr=["area","base","br","col","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"],en=["allowfullscreen","async","autofocus","autoplay","checked","controls","default","defer","disabled","download","formnovalidate","hidden","inert","ismap","itemscope","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"],Ot=(e,t)=>{for(let r=0,n=e.length;r<n;r++){const s=e[r];if(typeof s=="string")te(s,t);else{if(typeof s=="boolean"||s===null||s===void 0)continue;s instanceof H?s.toStringToBuffer(t):typeof s=="number"||s.isEscaped?t[0]+=s:s instanceof Promise?t.unshift("",s):Ot(s,t)}}},H=class{constructor(e,t,r){v(this,"tag");v(this,"props");v(this,"key");v(this,"children");v(this,"isEscaped",!0);v(this,"localContexts");this.tag=e,this.props=t,this.children=r}get type(){return this.tag}get ref(){return this.props.ref||null}toString(){var t,r;const e=[""];(t=this.localContexts)==null||t.forEach(([n,s])=>{n.values.push(s)});try{this.toStringToBuffer(e)}finally{(r=this.localContexts)==null||r.forEach(([n])=>{n.values.pop()})}return e.length===1?"callbacks"in e?nr(F(e[0],e.callbacks)).toString():e[0]:rr(e,e.callbacks)}toStringToBuffer(e){const t=this.tag,r=this.props;let{children:n}=this;e[0]+=`<${t}`;const s=De&&Se(De)==="svg"?a=>Zr(rt(a)):a=>rt(a);for(let[a,i]of Object.entries(r))if(a=s(a),a!=="children"){if(a==="style"&&typeof i=="object"){let o="";ur(i,(c,l)=>{l!=null&&(o+=`${o?";":""}${c}:${l}`)}),e[0]+=' style="',te(o,e),e[0]+='"'}else if(typeof i=="string")e[0]+=` ${a}="`,te(i,e),e[0]+='"';else if(i!=null)if(typeof i=="number"||i.isEscaped)e[0]+=` ${a}="${i}"`;else if(typeof i=="boolean"&&en.includes(a))i&&(e[0]+=` ${a}=""`);else if(a==="dangerouslySetInnerHTML"){if(n.length>0)throw new Error("Can only set one of `children` or `props.dangerouslySetInnerHTML`.");n=[F(i.__html)]}else if(i instanceof Promise)e[0]+=` ${a}="`,e.unshift('"',i);else if(typeof i=="function"){if(!a.startsWith("on")&&a!=="ref")throw new Error(`Invalid prop '${a}' of type 'function' supplied to '${t}'.`)}else e[0]+=` ${a}="`,te(i.toString(),e),e[0]+='"'}if(Qr.includes(t)&&n.length===0){e[0]+="/>";return}e[0]+=">",Ot(n,e),e[0]+=`</${t}>`}},lt=class extends H{toStringToBuffer(e){const{children:t}=this,r={...this.props};t.length&&(r.children=t.length===1?t[0]:t);const n=this.tag.call(null,r);if(!(typeof n=="boolean"||n==null))if(n instanceof Promise)if(Re.length===0)e.unshift("",n);else{const s=Re.map(a=>[a,a.values.at(-1)]);e.unshift("",n.then(a=>(a instanceof H&&(a.localContexts=s),a)))}else n instanceof H?n.toStringToBuffer(e):typeof n=="number"||n.isEscaped?(e[0]+=n,n.callbacks&&(e.callbacks||(e.callbacks=[]),e.callbacks.push(...n.callbacks))):te(n,e)}},dr=class extends H{toStringToBuffer(e){Ot(this.children,e)}},It=(e,t,...r)=>{t??(t={}),r.length&&(t.children=r.length===1?r[0]:r);const n=t.key;delete t.key;const s=Ye(e,t,r);return s.key=n,s},Pt=!1,Ye=(e,t,r)=>{if(!Pt){for(const n in gt)ct[n][Rt]=gt[n];Pt=!0}return typeof e=="function"?new lt(e,t,r):ct[e]?new lt(ct[e],t,r):e==="svg"||e==="head"?(De||(De=bt("")),new H(e,t,[new lt(De,{value:e},r)])):new H(e,t,r)},tn=({children:e})=>new dr("",{children:e},Array.isArray(e)?e:e?[e]:[]);function I(e,t,r){let n;if(!t||!("children"in t))n=Ye(e,t,[]);else{const s=t.children;n=Array.isArray(s)?Ye(e,t,s):Ye(e,t,[s])}return n.key=r,n}var Ft=(e,t,r)=>(n,s)=>{let a=-1;return i(0);async function i(o){if(o<=a)throw new Error("next() called multiple times");a=o;let c,l=!1,d;if(e[o]?(d=e[o][0][0],n.req.routeIndex=o):d=o===e.length&&s||void 0,d)try{c=await d(n,()=>i(o+1))}catch(f){if(f instanceof Error&&t)n.error=f,c=await t(f,n),l=!0;else throw f}else n.finalized===!1&&r&&(c=await r(n));return c&&(n.finalized===!1||l)&&(n.res=c),n}},rn=Symbol(),nn=async(e,t=Object.create(null))=>{const{all:r=!1,dot:n=!1}=t,a=(e instanceof vr?e.raw.headers:e.headers).get("Content-Type");return a!=null&&a.startsWith("multipart/form-data")||a!=null&&a.startsWith("application/x-www-form-urlencoded")?sn(e,{all:r,dot:n}):{}};async function sn(e,t){const r=await e.formData();return r?an(r,t):{}}function an(e,t){const r=Object.create(null);return e.forEach((n,s)=>{t.all||s.endsWith("[]")?on(r,s,n):r[s]=n}),t.dot&&Object.entries(r).forEach(([n,s])=>{n.includes(".")&&(cn(r,n,s),delete r[n])}),r}var on=(e,t,r)=>{e[t]!==void 0?Array.isArray(e[t])?e[t].push(r):e[t]=[e[t],r]:t.endsWith("[]")?e[t]=[r]:e[t]=r},cn=(e,t,r)=>{let n=e;const s=t.split(".");s.forEach((a,i)=>{i===s.length-1?n[a]=r:((!n[a]||typeof n[a]!="object"||Array.isArray(n[a])||n[a]instanceof File)&&(n[a]=Object.create(null)),n=n[a])})},fr=e=>{const t=e.split("/");return t[0]===""&&t.shift(),t},ln=e=>{const{groups:t,path:r}=un(e),n=fr(r);return dn(n,t)},un=e=>{const t=[];return e=e.replace(/\{[^}]+\}/g,(r,n)=>{const s=`@${n}`;return t.push([s,r]),s}),{groups:t,path:e}},dn=(e,t)=>{for(let r=t.length-1;r>=0;r--){const[n]=t[r];for(let s=e.length-1;s>=0;s--)if(e[s].includes(n)){e[s]=e[s].replace(n,t[r][1]);break}}return e},ze={},fn=(e,t)=>{if(e==="*")return"*";const r=e.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);if(r){const n=`${e}#${t}`;return ze[n]||(r[2]?ze[n]=t&&t[0]!==":"&&t[0]!=="*"?[n,r[1],new RegExp(`^${r[2]}(?=/${t})`)]:[e,r[1],new RegExp(`^${r[2]}$`)]:ze[n]=[e,r[1],!0]),ze[n]}return null},jt=(e,t)=>{try{return t(e)}catch{return e.replace(/(?:%[0-9A-Fa-f]{2})+/g,r=>{try{return t(r)}catch{return r}})}},pn=e=>jt(e,decodeURI),pr=e=>{const t=e.url,r=t.indexOf("/",t.indexOf(":")+4);let n=r;for(;n<t.length;n++){const s=t.charCodeAt(n);if(s===37){const a=t.indexOf("?",n),i=t.indexOf("#",n),o=a===-1?i===-1?void 0:i:i===-1?a:Math.min(a,i),c=t.slice(r,o);return pn(c.includes("%25")?c.replace(/%25/g,"%2525"):c)}else if(s===63||s===35)break}return t.slice(r,n)},hn=e=>{const t=pr(e);return t.length>1&&t.at(-1)==="/"?t.slice(0,-1):t},fe=(e,t,...r)=>(r.length&&(t=fe(t,...r)),`${(e==null?void 0:e[0])==="/"?"":"/"}${e}${t==="/"?"":`${(e==null?void 0:e.at(-1))==="/"?"":"/"}${(t==null?void 0:t[0])==="/"?t.slice(1):t}`}`),hr=e=>{if(e.charCodeAt(e.length-1)!==63||!e.includes(":"))return null;const t=e.split("/"),r=[];let n="";return t.forEach(s=>{if(s!==""&&!/\:/.test(s))n+="/"+s;else if(/\:/.test(s))if(/\?/.test(s)){r.length===0&&n===""?r.push("/"):r.push(n);const a=s.replace("?","");n+="/"+a,r.push(n)}else n+="/"+s}),r.filter((s,a,i)=>i.indexOf(s)===a)},ut=e=>/[%+]/.test(e)?(e.indexOf("+")!==-1&&(e=e.replace(/\+/g," ")),e.indexOf("%")!==-1?jt(e,yr):e):e,mr=(e,t,r)=>{let n;if(!r&&t&&!/[%+]/.test(t)){let i=e.indexOf("?",8);if(i===-1)return;for(e.startsWith(t,i+1)||(i=e.indexOf(`&${t}`,i+1));i!==-1;){const o=e.charCodeAt(i+t.length+1);if(o===61){const c=i+t.length+2,l=e.indexOf("&",c);return ut(e.slice(c,l===-1?void 0:l))}else if(o==38||isNaN(o))return"";i=e.indexOf(`&${t}`,i+1)}if(n=/[%+]/.test(e),!n)return}const s={};n??(n=/[%+]/.test(e));let a=e.indexOf("?",8);for(;a!==-1;){const i=e.indexOf("&",a+1);let o=e.indexOf("=",a);o>i&&i!==-1&&(o=-1);let c=e.slice(a+1,o===-1?i===-1?void 0:i:o);if(n&&(c=ut(c)),a=i,c==="")continue;let l;o===-1?l="":(l=e.slice(o+1,i===-1?void 0:i),n&&(l=ut(l))),r?(s[c]&&Array.isArray(s[c])||(s[c]=[]),s[c].push(l)):s[c]??(s[c]=l)}return t?s[t]:s},mn=mr,yn=(e,t)=>mr(e,t,!0),yr=decodeURIComponent,kt=e=>jt(e,yr),me,P,J,gr,_r,_t,Y,Yt,vr=(Yt=class{constructor(e,t="/",r=[[]]){w(this,J);v(this,"raw");w(this,me);w(this,P);v(this,"routeIndex",0);v(this,"path");v(this,"bodyCache",{});w(this,Y,e=>{const{bodyCache:t,raw:r}=this,n=t[e];if(n)return n;const s=Object.keys(t)[0];return s?t[s].then(a=>(s==="json"&&(a=JSON.stringify(a)),new Response(a)[e]())):t[e]=r[e]()});this.raw=e,this.path=t,_(this,P,r),_(this,me,{})}param(e){return e?S(this,J,gr).call(this,e):S(this,J,_r).call(this)}query(e){return mn(this.url,e)}queries(e){return yn(this.url,e)}header(e){if(e)return this.raw.headers.get(e)??void 0;const t={};return this.raw.headers.forEach((r,n)=>{t[n]=r}),t}async parseBody(e){var t;return(t=this.bodyCache).parsedBody??(t.parsedBody=await nn(this,e))}json(){return u(this,Y).call(this,"text").then(e=>JSON.parse(e))}text(){return u(this,Y).call(this,"text")}arrayBuffer(){return u(this,Y).call(this,"arrayBuffer")}blob(){return u(this,Y).call(this,"blob")}formData(){return u(this,Y).call(this,"formData")}addValidatedData(e,t){u(this,me)[e]=t}valid(e){return u(this,me)[e]}get url(){return this.raw.url}get method(){return this.raw.method}get[rn](){return u(this,P)}get matchedRoutes(){return u(this,P)[0].map(([[,e]])=>e)}get routePath(){return u(this,P)[0].map(([[,e]])=>e)[this.routeIndex].path}},me=new WeakMap,P=new WeakMap,J=new WeakSet,gr=function(e){const t=u(this,P)[0][this.routeIndex][1][e],r=S(this,J,_t).call(this,t);return r&&/\%/.test(r)?kt(r):r},_r=function(){const e={},t=Object.keys(u(this,P)[0][this.routeIndex][1]);for(const r of t){const n=S(this,J,_t).call(this,u(this,P)[0][this.routeIndex][1][r]);n!==void 0&&(e[r]=/\%/.test(n)?kt(n):n)}return e},_t=function(e){return u(this,P)[1]?u(this,P)[1][e]:e},Y=new WeakMap,Yt),vn="text/plain; charset=UTF-8",dt=(e,t)=>({"Content-Type":e,...t}),Ie,Pe,U,ye,W,q,Fe,ve,ge,se,ke,Le,G,pe,Gt,gn=(Gt=class{constructor(e,t){w(this,G);w(this,Ie);w(this,Pe);v(this,"env",{});w(this,U);v(this,"finalized",!1);v(this,"error");w(this,ye);w(this,W);w(this,q);w(this,Fe);w(this,ve);w(this,ge);w(this,se);w(this,ke);w(this,Le);v(this,"render",(...e)=>(u(this,ve)??_(this,ve,t=>this.html(t)),u(this,ve).call(this,...e)));v(this,"setLayout",e=>_(this,Fe,e));v(this,"getLayout",()=>u(this,Fe));v(this,"setRenderer",e=>{_(this,ve,e)});v(this,"header",(e,t,r)=>{this.finalized&&_(this,q,new Response(u(this,q).body,u(this,q)));const n=u(this,q)?u(this,q).headers:u(this,se)??_(this,se,new Headers);t===void 0?n.delete(e):r!=null&&r.append?n.append(e,t):n.set(e,t)});v(this,"status",e=>{_(this,ye,e)});v(this,"set",(e,t)=>{u(this,U)??_(this,U,new Map),u(this,U).set(e,t)});v(this,"get",e=>u(this,U)?u(this,U).get(e):void 0);v(this,"newResponse",(...e)=>S(this,G,pe).call(this,...e));v(this,"body",(e,t,r)=>S(this,G,pe).call(this,e,t,r));v(this,"text",(e,t,r)=>!u(this,se)&&!u(this,ye)&&!t&&!r&&!this.finalized?new Response(e):S(this,G,pe).call(this,e,t,dt(vn,r)));v(this,"json",(e,t,r)=>S(this,G,pe).call(this,JSON.stringify(e),t,dt("application/json",r)));v(this,"html",(e,t,r)=>{const n=s=>S(this,G,pe).call(this,s,t,dt("text/html; charset=UTF-8",r));return typeof e=="object"?sr(e,tr.Stringify,!1,{}).then(n):n(e)});v(this,"redirect",(e,t)=>{const r=String(e);return this.header("Location",/[^\x00-\xFF]/.test(r)?encodeURI(r):r),this.newResponse(null,t??302)});v(this,"notFound",()=>(u(this,ge)??_(this,ge,()=>new Response),u(this,ge).call(this,this)));_(this,Ie,e),t&&(_(this,W,t.executionCtx),this.env=t.env,_(this,ge,t.notFoundHandler),_(this,Le,t.path),_(this,ke,t.matchResult))}get req(){return u(this,Pe)??_(this,Pe,new vr(u(this,Ie),u(this,Le),u(this,ke))),u(this,Pe)}get event(){if(u(this,W)&&"respondWith"in u(this,W))return u(this,W);throw Error("This context has no FetchEvent")}get executionCtx(){if(u(this,W))return u(this,W);throw Error("This context has no ExecutionContext")}get res(){return u(this,q)||_(this,q,new Response(null,{headers:u(this,se)??_(this,se,new Headers)}))}set res(e){if(u(this,q)&&e){e=new Response(e.body,e);for(const[t,r]of u(this,q).headers.entries())if(t!=="content-type")if(t==="set-cookie"){const n=u(this,q).headers.getSetCookie();e.headers.delete("set-cookie");for(const s of n)e.headers.append("set-cookie",s)}else e.headers.set(t,r)}_(this,q,e),this.finalized=!0}get var(){return u(this,U)?Object.fromEntries(u(this,U)):{}}},Ie=new WeakMap,Pe=new WeakMap,U=new WeakMap,ye=new WeakMap,W=new WeakMap,q=new WeakMap,Fe=new WeakMap,ve=new WeakMap,ge=new WeakMap,se=new WeakMap,ke=new WeakMap,Le=new WeakMap,G=new WeakSet,pe=function(e,t,r){const n=u(this,q)?new Headers(u(this,q).headers):u(this,se)??new Headers;if(typeof t=="object"&&"headers"in t){const a=t.headers instanceof Headers?t.headers:new Headers(t.headers);for(const[i,o]of a)i.toLowerCase()==="set-cookie"?n.append(i,o):n.set(i,o)}if(r)for(const[a,i]of Object.entries(r))if(typeof i=="string")n.set(a,i);else{n.delete(a);for(const o of i)n.append(a,o)}const s=typeof t=="number"?t:(t==null?void 0:t.status)??u(this,ye);return new Response(e,{status:s,headers:n})},Gt),T="ALL",_n="all",En=["get","post","put","delete","options","patch"],Er="Can not add a route since the matcher is already built.",wr=class extends Error{},wn="__COMPOSED_HANDLER",Rn=e=>e.text("404 Not Found",404),Lt=(e,t)=>{if("getResponse"in e){const r=e.getResponse();return t.newResponse(r.body,r)}return console.error(e),t.text("Internal Server Error",500)},k,N,Rr,L,re,Ge,Xe,_e,bn=(_e=class{constructor(t={}){w(this,N);v(this,"get");v(this,"post");v(this,"put");v(this,"delete");v(this,"options");v(this,"patch");v(this,"all");v(this,"on");v(this,"use");v(this,"router");v(this,"getPath");v(this,"_basePath","/");w(this,k,"/");v(this,"routes",[]);w(this,L,Rn);v(this,"errorHandler",Lt);v(this,"onError",t=>(this.errorHandler=t,this));v(this,"notFound",t=>(_(this,L,t),this));v(this,"fetch",(t,...r)=>S(this,N,Xe).call(this,t,r[1],r[0],t.method));v(this,"request",(t,r,n,s)=>t instanceof Request?this.fetch(r?new Request(t,r):t,n,s):(t=t.toString(),this.fetch(new Request(/^https?:\/\//.test(t)?t:`http://localhost${fe("/",t)}`,r),n,s)));v(this,"fire",()=>{addEventListener("fetch",t=>{t.respondWith(S(this,N,Xe).call(this,t.request,t,void 0,t.request.method))})});[...En,_n].forEach(a=>{this[a]=(i,...o)=>(typeof i=="string"?_(this,k,i):S(this,N,re).call(this,a,u(this,k),i),o.forEach(c=>{S(this,N,re).call(this,a,u(this,k),c)}),this)}),this.on=(a,i,...o)=>{for(const c of[i].flat()){_(this,k,c);for(const l of[a].flat())o.map(d=>{S(this,N,re).call(this,l.toUpperCase(),u(this,k),d)})}return this},this.use=(a,...i)=>(typeof a=="string"?_(this,k,a):(_(this,k,"*"),i.unshift(a)),i.forEach(o=>{S(this,N,re).call(this,T,u(this,k),o)}),this);const{strict:n,...s}=t;Object.assign(this,s),this.getPath=n??!0?t.getPath??pr:hn}route(t,r){const n=this.basePath(t);return r.routes.map(s=>{var i;let a;r.errorHandler===Lt?a=s.handler:(a=async(o,c)=>(await Ft([],r.errorHandler)(o,()=>s.handler(o,c))).res,a[wn]=s.handler),S(i=n,N,re).call(i,s.method,s.path,a)}),this}basePath(t){const r=S(this,N,Rr).call(this);return r._basePath=fe(this._basePath,t),r}mount(t,r,n){let s,a;n&&(typeof n=="function"?a=n:(a=n.optionHandler,n.replaceRequest===!1?s=c=>c:s=n.replaceRequest));const i=a?c=>{const l=a(c);return Array.isArray(l)?l:[l]}:c=>{let l;try{l=c.executionCtx}catch{}return[c.env,l]};s||(s=(()=>{const c=fe(this._basePath,t),l=c==="/"?0:c.length;return d=>{const f=new URL(d.url);return f.pathname=f.pathname.slice(l)||"/",new Request(f,d)}})());const o=async(c,l)=>{const d=await r(s(c.req.raw),...i(c));if(d)return d;await l()};return S(this,N,re).call(this,T,fe(t,"*"),o),this}},k=new WeakMap,N=new WeakSet,Rr=function(){const t=new _e({router:this.router,getPath:this.getPath});return t.errorHandler=this.errorHandler,_(t,L,u(this,L)),t.routes=this.routes,t},L=new WeakMap,re=function(t,r,n){t=t.toUpperCase(),r=fe(this._basePath,r);const s={basePath:this._basePath,path:r,method:t,handler:n};this.router.add(t,r,[n,s]),this.routes.push(s)},Ge=function(t,r){if(t instanceof Error)return this.errorHandler(t,r);throw t},Xe=function(t,r,n,s){if(s==="HEAD")return(async()=>new Response(null,await S(this,N,Xe).call(this,t,r,n,"GET")))();const a=this.getPath(t,{env:n}),i=this.router.match(s,a),o=new gn(t,{path:a,matchResult:i,env:n,executionCtx:r,notFoundHandler:u(this,L)});if(i[0].length===1){let l;try{l=i[0][0][0][0](o,async()=>{o.res=await u(this,L).call(this,o)})}catch(d){return S(this,N,Ge).call(this,d,o)}return l instanceof Promise?l.then(d=>d||(o.finalized?o.res:u(this,L).call(this,o))).catch(d=>S(this,N,Ge).call(this,d,o)):l??u(this,L).call(this,o)}const c=Ft(i[0],this.errorHandler,u(this,L));return(async()=>{try{const l=await c(o);if(!l.finalized)throw new Error("Context is not finalized. Did you forget to return a Response object or `await next()`?");return l.res}catch(l){return S(this,N,Ge).call(this,l,o)}})()},_e),br=[];function Sn(e,t){const r=this.buildAllMatchers(),n=((s,a)=>{const i=r[s]||r[T],o=i[2][a];if(o)return o;const c=a.match(i[0]);if(!c)return[[],br];const l=c.indexOf("",1);return[i[1][l],c]});return this.match=n,n(e,t)}var nt="[^/]+",Te=".*",Ne="(?:|/.*)",he=Symbol(),On=new Set(".\\+*[^]$()");function jn(e,t){return e.length===1?t.length===1?e<t?-1:1:-1:t.length===1||e===Te||e===Ne?1:t===Te||t===Ne?-1:e===nt?1:t===nt?-1:e.length===t.length?e<t?-1:1:t.length-e.length}var ae,ie,M,le,xn=(le=class{constructor(){w(this,ae);w(this,ie);w(this,M,Object.create(null))}insert(t,r,n,s,a){if(t.length===0){if(u(this,ae)!==void 0)throw he;if(a)return;_(this,ae,r);return}const[i,...o]=t,c=i==="*"?o.length===0?["","",Te]:["","",nt]:i==="/*"?["","",Ne]:i.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);let l;if(c){const d=c[1];let f=c[2]||nt;if(d&&c[2]&&(f===".*"||(f=f.replace(/^\((?!\?:)(?=[^)]+\)$)/,"(?:"),/\((?!\?:)/.test(f))))throw he;if(l=u(this,M)[f],!l){if(Object.keys(u(this,M)).some(p=>p!==Te&&p!==Ne))throw he;if(a)return;l=u(this,M)[f]=new le,d!==""&&_(l,ie,s.varIndex++)}!a&&d!==""&&n.push([d,u(l,ie)])}else if(l=u(this,M)[i],!l){if(Object.keys(u(this,M)).some(d=>d.length>1&&d!==Te&&d!==Ne))throw he;if(a)return;l=u(this,M)[i]=new le}l.insert(o,r,n,s,a)}buildRegExpStr(){const r=Object.keys(u(this,M)).sort(jn).map(n=>{const s=u(this,M)[n];return(typeof u(s,ie)=="number"?`(${n})@${u(s,ie)}`:On.has(n)?`\\${n}`:n)+s.buildRegExpStr()});return typeof u(this,ae)=="number"&&r.unshift(`#${u(this,ae)}`),r.length===0?"":r.length===1?r[0]:"(?:"+r.join("|")+")"}},ae=new WeakMap,ie=new WeakMap,M=new WeakMap,le),st,Me,Xt,An=(Xt=class{constructor(){w(this,st,{varIndex:0});w(this,Me,new xn)}insert(e,t,r){const n=[],s=[];for(let i=0;;){let o=!1;if(e=e.replace(/\{[^}]+\}/g,c=>{const l=`@\\${i}`;return s[i]=[l,c],i++,o=!0,l}),!o)break}const a=e.match(/(?::[^\/]+)|(?:\/\*$)|./g)||[];for(let i=s.length-1;i>=0;i--){const[o]=s[i];for(let c=a.length-1;c>=0;c--)if(a[c].indexOf(o)!==-1){a[c]=a[c].replace(o,s[i][1]);break}}return u(this,Me).insert(a,t,n,u(this,st),r),n}buildRegExp(){let e=u(this,Me).buildRegExpStr();if(e==="")return[/^$/,[],[]];let t=0;const r=[],n=[];return e=e.replace(/#(\d+)|@(\d+)|\.\*\$/g,(s,a,i)=>a!==void 0?(r[++t]=Number(a),"$()"):(i!==void 0&&(n[Number(i)]=++t),"")),[new RegExp(`^${e}`),r,n]}},st=new WeakMap,Me=new WeakMap,Xt),Tn=[/^$/,[],Object.create(null)],Ze=Object.create(null);function Sr(e){return Ze[e]??(Ze[e]=new RegExp(e==="*"?"":`^${e.replace(/\/\*$|([.\\+*[^\]$()])/g,(t,r)=>r?`\\${r}`:"(?:|/.*)")}$`))}function Nn(){Ze=Object.create(null)}function Dn(e){var l;const t=new An,r=[];if(e.length===0)return Tn;const n=e.map(d=>[!/\*|\/:/.test(d[0]),...d]).sort(([d,f],[p,h])=>d?1:p?-1:f.length-h.length),s=Object.create(null);for(let d=0,f=-1,p=n.length;d<p;d++){const[h,y,g]=n[d];h?s[y]=[g.map(([E])=>[E,Object.create(null)]),br]:f++;let m;try{m=t.insert(y,f,h)}catch(E){throw E===he?new wr(y):E}h||(r[f]=g.map(([E,R])=>{const j=Object.create(null);for(R-=1;R>=0;R--){const[O,x]=m[R];j[O]=x}return[E,j]}))}const[a,i,o]=t.buildRegExp();for(let d=0,f=r.length;d<f;d++)for(let p=0,h=r[d].length;p<h;p++){const y=(l=r[d][p])==null?void 0:l[1];if(!y)continue;const g=Object.keys(y);for(let m=0,E=g.length;m<E;m++)y[g[m]]=o[y[g[m]]]}const c=[];for(const d in i)c[d]=r[i[d]];return[a,c,s]}function ue(e,t){if(e){for(const r of Object.keys(e).sort((n,s)=>s.length-n.length))if(Sr(r).test(t))return[...e[r]]}}var X,Z,at,Or,Zt,Cn=(Zt=class{constructor(){w(this,at);v(this,"name","RegExpRouter");w(this,X);w(this,Z);v(this,"match",Sn);_(this,X,{[T]:Object.create(null)}),_(this,Z,{[T]:Object.create(null)})}add(e,t,r){var o;const n=u(this,X),s=u(this,Z);if(!n||!s)throw new Error(Er);n[e]||[n,s].forEach(c=>{c[e]=Object.create(null),Object.keys(c[T]).forEach(l=>{c[e][l]=[...c[T][l]]})}),t==="/*"&&(t="*");const a=(t.match(/\/:/g)||[]).length;if(/\*$/.test(t)){const c=Sr(t);e===T?Object.keys(n).forEach(l=>{var d;(d=n[l])[t]||(d[t]=ue(n[l],t)||ue(n[T],t)||[])}):(o=n[e])[t]||(o[t]=ue(n[e],t)||ue(n[T],t)||[]),Object.keys(n).forEach(l=>{(e===T||e===l)&&Object.keys(n[l]).forEach(d=>{c.test(d)&&n[l][d].push([r,a])})}),Object.keys(s).forEach(l=>{(e===T||e===l)&&Object.keys(s[l]).forEach(d=>c.test(d)&&s[l][d].push([r,a]))});return}const i=hr(t)||[t];for(let c=0,l=i.length;c<l;c++){const d=i[c];Object.keys(s).forEach(f=>{var p;(e===T||e===f)&&((p=s[f])[d]||(p[d]=[...ue(n[f],d)||ue(n[T],d)||[]]),s[f][d].push([r,a-l+c+1]))})}}buildAllMatchers(){const e=Object.create(null);return Object.keys(u(this,Z)).concat(Object.keys(u(this,X))).forEach(t=>{e[t]||(e[t]=S(this,at,Or).call(this,t))}),_(this,X,_(this,Z,void 0)),Nn(),e}},X=new WeakMap,Z=new WeakMap,at=new WeakSet,Or=function(e){const t=[];let r=e===T;return[u(this,X),u(this,Z)].forEach(n=>{const s=n[e]?Object.keys(n[e]).map(a=>[a,n[e][a]]):[];s.length!==0?(r||(r=!0),t.push(...s)):e!==T&&t.push(...Object.keys(n[T]).map(a=>[a,n[T][a]]))}),r?Dn(t):null},Zt),Q,z,Qt,qn=(Qt=class{constructor(e){v(this,"name","SmartRouter");w(this,Q,[]);w(this,z,[]);_(this,Q,e.routers)}add(e,t,r){if(!u(this,z))throw new Error(Er);u(this,z).push([e,t,r])}match(e,t){if(!u(this,z))throw new Error("Fatal error");const r=u(this,Q),n=u(this,z),s=r.length;let a=0,i;for(;a<s;a++){const o=r[a];try{for(let c=0,l=n.length;c<l;c++)o.add(...n[c]);i=o.match(e,t)}catch(c){if(c instanceof wr)continue;throw c}this.match=o.match.bind(o),_(this,Q,[o]),_(this,z,void 0);break}if(a===s)throw new Error("Fatal error");return this.name=`SmartRouter + ${this.activeRouter.name}`,i}get activeRouter(){if(u(this,z)||u(this,Q).length!==1)throw new Error("No active router has been determined yet.");return u(this,Q)[0]}},Q=new WeakMap,z=new WeakMap,Qt),xe=Object.create(null),ee,C,oe,Ee,D,V,ne,we,In=(we=class{constructor(t,r,n){w(this,V);w(this,ee);w(this,C);w(this,oe);w(this,Ee,0);w(this,D,xe);if(_(this,C,n||Object.create(null)),_(this,ee,[]),t&&r){const s=Object.create(null);s[t]={handler:r,possibleKeys:[],score:0},_(this,ee,[s])}_(this,oe,[])}insert(t,r,n){_(this,Ee,++Nt(this,Ee)._);let s=this;const a=ln(r),i=[];for(let o=0,c=a.length;o<c;o++){const l=a[o],d=a[o+1],f=fn(l,d),p=Array.isArray(f)?f[0]:l;if(p in u(s,C)){s=u(s,C)[p],f&&i.push(f[1]);continue}u(s,C)[p]=new we,f&&(u(s,oe).push(f),i.push(f[1])),s=u(s,C)[p]}return u(s,ee).push({[t]:{handler:n,possibleKeys:i.filter((o,c,l)=>l.indexOf(o)===c),score:u(this,Ee)}}),s}search(t,r){var c;const n=[];_(this,D,xe);let a=[this];const i=fr(r),o=[];for(let l=0,d=i.length;l<d;l++){const f=i[l],p=l===d-1,h=[];for(let y=0,g=a.length;y<g;y++){const m=a[y],E=u(m,C)[f];E&&(_(E,D,u(m,D)),p?(u(E,C)["*"]&&n.push(...S(this,V,ne).call(this,u(E,C)["*"],t,u(m,D))),n.push(...S(this,V,ne).call(this,E,t,u(m,D)))):h.push(E));for(let R=0,j=u(m,oe).length;R<j;R++){const O=u(m,oe)[R],x=u(m,D)===xe?{}:{...u(m,D)};if(O==="*"){const K=u(m,C)["*"];K&&(n.push(...S(this,V,ne).call(this,K,t,u(m,D))),_(K,D,x),h.push(K));continue}const[Oe,We,je]=O;if(!f&&!(je instanceof RegExp))continue;const $=u(m,C)[Oe],kr=i.slice(l).join("/");if(je instanceof RegExp){const K=je.exec(kr);if(K){if(x[We]=K[0],n.push(...S(this,V,ne).call(this,$,t,u(m,D),x)),Object.keys(u($,C)).length){_($,D,x);const it=((c=K[0].match(/\//))==null?void 0:c.length)??0;(o[it]||(o[it]=[])).push($)}continue}}(je===!0||je.test(f))&&(x[We]=f,p?(n.push(...S(this,V,ne).call(this,$,t,x,u(m,D))),u($,C)["*"]&&n.push(...S(this,V,ne).call(this,u($,C)["*"],t,x,u(m,D)))):(_($,D,x),h.push($)))}}a=h.concat(o.shift()??[])}return n.length>1&&n.sort((l,d)=>l.score-d.score),[n.map(({handler:l,params:d})=>[l,d])]}},ee=new WeakMap,C=new WeakMap,oe=new WeakMap,Ee=new WeakMap,D=new WeakMap,V=new WeakSet,ne=function(t,r,n,s){const a=[];for(let i=0,o=u(t,ee).length;i<o;i++){const c=u(t,ee)[i],l=c[r]||c[T],d={};if(l!==void 0&&(l.params=Object.create(null),a.push(l),n!==xe||s&&s!==xe))for(let f=0,p=l.possibleKeys.length;f<p;f++){const h=l.possibleKeys[f],y=d[l.score];l.params[h]=s!=null&&s[h]&&!y?s[h]:n[h]??(s==null?void 0:s[h]),d[l.score]=!0}}return a},we),ce,er,Pn=(er=class{constructor(){v(this,"name","TrieRouter");w(this,ce);_(this,ce,new In)}add(e,t,r){const n=hr(t);if(n){for(let s=0,a=n.length;s<a;s++)u(this,ce).insert(e,n[s],r);return}u(this,ce).insert(e,t,r)}match(e,t){return u(this,ce).search(e,t)}},ce=new WeakMap,er),jr=class extends bn{constructor(e={}){super(e),this.router=e.router??new qn({routers:[new Cn,new Pn]})}},Fn=e=>{const r={...{origin:"*",allowMethods:["GET","HEAD","PUT","POST","DELETE","PATCH"],allowHeaders:[],exposeHeaders:[]},...e},n=(a=>typeof a=="string"?a==="*"?()=>a:i=>a===i?i:null:typeof a=="function"?a:i=>a.includes(i)?i:null)(r.origin),s=(a=>typeof a=="function"?a:Array.isArray(a)?()=>a:()=>[])(r.allowMethods);return async function(i,o){var d;function c(f,p){i.res.headers.set(f,p)}const l=await n(i.req.header("origin")||"",i);if(l&&c("Access-Control-Allow-Origin",l),r.credentials&&c("Access-Control-Allow-Credentials","true"),(d=r.exposeHeaders)!=null&&d.length&&c("Access-Control-Expose-Headers",r.exposeHeaders.join(",")),i.req.method==="OPTIONS"){r.origin!=="*"&&c("Vary","Origin"),r.maxAge!=null&&c("Access-Control-Max-Age",r.maxAge.toString());const f=await s(i.req.header("origin")||"",i);f.length&&c("Access-Control-Allow-Methods",f.join(","));let p=r.allowHeaders;if(!(p!=null&&p.length)){const h=i.req.header("Access-Control-Request-Headers");h&&(p=h.split(/\s*,\s*/))}return p!=null&&p.length&&(c("Access-Control-Allow-Headers",p.join(",")),i.res.headers.append("Vary","Access-Control-Request-Headers")),i.res.headers.delete("Content-Length"),i.res.headers.delete("Content-Type"),new Response(null,{headers:i.res.headers,status:204,statusText:"No Content"})}await o(),r.origin!=="*"&&i.header("Vary","Origin",{append:!0})}},kn=/^\s*(?:text\/(?!event-stream(?:[;\s]|$))[^;\s]+|application\/(?:javascript|json|xml|xml-dtd|ecmascript|dart|postscript|rtf|tar|toml|vnd\.dart|vnd\.ms-fontobject|vnd\.ms-opentype|wasm|x-httpd-php|x-javascript|x-ns-proxy-autoconfig|x-sh|x-tar|x-virtualbox-hdd|x-virtualbox-ova|x-virtualbox-ovf|x-virtualbox-vbox|x-virtualbox-vdi|x-virtualbox-vhd|x-virtualbox-vmdk|x-www-form-urlencoded)|font\/(?:otf|ttf)|image\/(?:bmp|vnd\.adobe\.photoshop|vnd\.microsoft\.icon|vnd\.ms-dds|x-icon|x-ms-bmp)|message\/rfc822|model\/gltf-binary|x-shader\/x-fragment|x-shader\/x-vertex|[^;\s]+?\+(?:json|text|xml|yaml))(?:[;\s]|$)/i,Mt=(e,t=Mn)=>{const r=/\.([a-zA-Z0-9]+?)$/,n=e.match(r);if(!n)return;let s=t[n[1]];return s&&s.startsWith("text")&&(s+="; charset=utf-8"),s},Ln={aac:"audio/aac",avi:"video/x-msvideo",avif:"image/avif",av1:"video/av1",bin:"application/octet-stream",bmp:"image/bmp",css:"text/css",csv:"text/csv",eot:"application/vnd.ms-fontobject",epub:"application/epub+zip",gif:"image/gif",gz:"application/gzip",htm:"text/html",html:"text/html",ico:"image/x-icon",ics:"text/calendar",jpeg:"image/jpeg",jpg:"image/jpeg",js:"text/javascript",json:"application/json",jsonld:"application/ld+json",map:"application/json",mid:"audio/x-midi",midi:"audio/x-midi",mjs:"text/javascript",mp3:"audio/mpeg",mp4:"video/mp4",mpeg:"video/mpeg",oga:"audio/ogg",ogv:"video/ogg",ogx:"application/ogg",opus:"audio/opus",otf:"font/otf",pdf:"application/pdf",png:"image/png",rtf:"application/rtf",svg:"image/svg+xml",tif:"image/tiff",tiff:"image/tiff",ts:"video/mp2t",ttf:"font/ttf",txt:"text/plain",wasm:"application/wasm",webm:"video/webm",weba:"audio/webm",webmanifest:"application/manifest+json",webp:"image/webp",woff:"font/woff",woff2:"font/woff2",xhtml:"application/xhtml+xml",xml:"application/xml",zip:"application/zip","3gp":"video/3gpp","3g2":"video/3gpp2",gltf:"model/gltf+json",glb:"model/gltf-binary"},Mn=Ln,Hn=(...e)=>{let t=e.filter(s=>s!=="").join("/");t=t.replace(new RegExp("(?<=\\/)\\/+","g"),"");const r=t.split("/"),n=[];for(const s of r)s===".."&&n.length>0&&n.at(-1)!==".."?n.pop():s!=="."&&n.push(s);return n.join("/")||"."},xr={br:".br",zstd:".zst",gzip:".gz"},$n=Object.keys(xr),Bn="index.html",Un=e=>{const t=e.root??"./",r=e.path,n=e.join??Hn;return async(s,a)=>{var d,f,p,h;if(s.finalized)return a();let i;if(e.path)i=e.path;else try{if(i=decodeURIComponent(s.req.path),/(?:^|[\/\\])\.\.(?:$|[\/\\])/.test(i))throw new Error}catch{return await((d=e.onNotFound)==null?void 0:d.call(e,s.req.path,s)),a()}let o=n(t,!r&&e.rewriteRequestPath?e.rewriteRequestPath(i):i);e.isDir&&await e.isDir(o)&&(o=n(o,Bn));const c=e.getContent;let l=await c(o,s);if(l instanceof Response)return s.newResponse(l.body,l);if(l){const y=e.mimes&&Mt(o,e.mimes)||Mt(o);if(s.header("Content-Type",y||"application/octet-stream"),e.precompressed&&(!y||kn.test(y))){const g=new Set((f=s.req.header("Accept-Encoding"))==null?void 0:f.split(",").map(m=>m.trim()));for(const m of $n){if(!g.has(m))continue;const E=await c(o+xr[m],s);if(E){l=E,s.header("Content-Encoding",m),s.header("Vary","Accept-Encoding",{append:!0});break}}}return await((p=e.onFound)==null?void 0:p.call(e,o,s)),s.body(l)}await((h=e.onNotFound)==null?void 0:h.call(e,o,s)),await a()}},Wn=async(e,t)=>{let r;t&&t.manifest?typeof t.manifest=="string"?r=JSON.parse(t.manifest):r=t.manifest:typeof __STATIC_CONTENT_MANIFEST=="string"?r=JSON.parse(__STATIC_CONTENT_MANIFEST):r=__STATIC_CONTENT_MANIFEST;let n;t&&t.namespace?n=t.namespace:n=__STATIC_CONTENT;const s=r[e];if(!s)return null;const a=await n.get(s,{type:"stream"});return a||null},zn=e=>async function(r,n){return Un({...e,getContent:async a=>Wn(a,{manifest:e.manifest,namespace:e.namespace?e.namespace:r.env?r.env.__STATIC_CONTENT:void 0})})(r,n)},Vn=e=>zn(e),Ce="_hp",Jn={Change:"Input",DoubleClick:"DblClick"},Kn={svg:"2000/svg",math:"1998/Math/MathML"},qe=[],Et=new WeakMap,be=void 0,Yn=()=>be,B=e=>"t"in e,ft={onClick:["click",!1]},Ht=e=>{if(!e.startsWith("on"))return;if(ft[e])return ft[e];const t=e.match(/^on([A-Z][a-zA-Z]+?(?:PointerCapture)?)(Capture)?$/);if(t){const[,r,n]=t;return ft[e]=[(Jn[r]||r).toLowerCase(),!!n]}},$t=(e,t)=>be&&e instanceof SVGElement&&/[A-Z]/.test(t)&&(t in e.style||t.match(/^(?:o|pai|str|u|ve)/))?t.replace(/([A-Z])/g,"-$1").toLowerCase():t,Gn=(e,t,r)=>{var n;t||(t={});for(let s in t){const a=t[s];if(s!=="children"&&(!r||r[s]!==a)){s=rt(s);const i=Ht(s);if(i){if((r==null?void 0:r[s])!==a&&(r&&e.removeEventListener(i[0],r[s],i[1]),a!=null)){if(typeof a!="function")throw new Error(`Event handler for "${s}" is not a function`);e.addEventListener(i[0],a,i[1])}}else if(s==="dangerouslySetInnerHTML"&&a)e.innerHTML=a.__html;else if(s==="ref"){let o;typeof a=="function"?o=a(e)||(()=>a(null)):a&&"current"in a&&(a.current=e,o=()=>a.current=null),Et.set(e,o)}else if(s==="style"){const o=e.style;typeof a=="string"?o.cssText=a:(o.cssText="",a!=null&&ur(a,o.setProperty.bind(o)))}else{if(s==="value"){const c=e.nodeName;if(c==="INPUT"||c==="TEXTAREA"||c==="SELECT"){if(e.value=a==null||a===!1?null:a,c==="TEXTAREA"){e.textContent=a;continue}else if(c==="SELECT"){e.selectedIndex===-1&&(e.selectedIndex=0);continue}}}else(s==="checked"&&e.nodeName==="INPUT"||s==="selected"&&e.nodeName==="OPTION")&&(e[s]=a);const o=$t(e,s);a==null||a===!1?e.removeAttribute(o):a===!0?e.setAttribute(o,""):typeof a=="string"||typeof a=="number"?e.setAttribute(o,a):e.setAttribute(o,a.toString())}}}if(r)for(let s in r){const a=r[s];if(s!=="children"&&!(s in t)){s=rt(s);const i=Ht(s);i?e.removeEventListener(i[0],a,i[1]):s==="ref"?(n=Et.get(e))==null||n():e.removeAttribute($t(e,s))}}},Xn=(e,t)=>{t[A][0]=0,qe.push([e,t]);const r=t.tag[Rt]||t.tag,n=r.defaultProps?{...r.defaultProps,...t.props}:t.props;try{return[r.call(null,n)]}finally{qe.pop()}},Ar=(e,t,r,n,s)=>{var a,i;(a=e.vR)!=null&&a.length&&(n.push(...e.vR),delete e.vR),typeof e.tag=="function"&&((i=e[A][1][Cr])==null||i.forEach(o=>s.push(o))),e.vC.forEach(o=>{var c;if(B(o))r.push(o);else if(typeof o.tag=="function"||o.tag===""){o.c=t;const l=r.length;if(Ar(o,t,r,n,s),o.s){for(let d=l;d<r.length;d++)r[d].s=!0;o.s=!1}}else r.push(o),(c=o.vR)!=null&&c.length&&(n.push(...o.vR),delete o.vR)})},Zn=e=>{var t;for(;e&&(e.tag===Ce||!e.e);)e=e.tag===Ce||!((t=e.vC)!=null&&t[0])?e.nN:e.vC[0];return e==null?void 0:e.e},Tr=e=>{var t,r,n,s,a,i;B(e)||((r=(t=e[A])==null?void 0:t[1][Cr])==null||r.forEach(o=>{var c;return(c=o[2])==null?void 0:c.call(o)}),(n=Et.get(e.e))==null||n(),e.p===2&&((s=e.vC)==null||s.forEach(o=>o.p=2)),(a=e.vC)==null||a.forEach(Tr)),e.p||((i=e.e)==null||i.remove(),delete e.e),typeof e.tag=="function"&&(Ae.delete(e),Qe.delete(e),delete e[A][3],e.a=!0)},Nr=(e,t,r)=>{e.c=t,Dr(e,t,r)},Bt=(e,t)=>{if(t){for(let r=0,n=e.length;r<n;r++)if(e[r]===t)return r}},Ut=Symbol(),Dr=(e,t,r)=>{var l;const n=[],s=[],a=[];Ar(e,t,n,s,a),s.forEach(Tr);const i=r?void 0:t.childNodes;let o,c=null;if(r)o=-1;else if(!i.length)o=0;else{const d=Bt(i,Zn(e.nN));d!==void 0?(c=i[d],o=d):o=Bt(i,(l=n.find(f=>f.tag!==Ce&&f.e))==null?void 0:l.e)??-1,o===-1&&(r=!0)}for(let d=0,f=n.length;d<f;d++,o++){const p=n[d];let h;if(p.s&&p.e)h=p.e,p.s=!1;else{const y=r||!p.e;B(p)?(p.e&&p.d&&(p.e.textContent=p.t),p.d=!1,h=p.e||(p.e=document.createTextNode(p.t))):(h=p.e||(p.e=p.n?document.createElementNS(p.n,p.tag):document.createElement(p.tag)),Gn(h,p.props,p.pP),Dr(p,h,y))}p.tag===Ce?o--:r?h.parentNode||t.appendChild(h):i[o]!==h&&i[o-1]!==h&&(i[o+1]===h?t.appendChild(i[o]):t.insertBefore(h,c||i[o]||null))}if(e.pP&&(e.pP=void 0),a.length){const d=[],f=[];a.forEach(([,p,,h,y])=>{p&&d.push(p),h&&f.push(h),y==null||y()}),d.forEach(p=>p()),f.length&&requestAnimationFrame(()=>{f.forEach(p=>p())})}},Qn=(e,t)=>!!(e&&e.length===t.length&&e.every((r,n)=>r[1]===t[n][1])),Qe=new WeakMap,wt=(e,t,r)=>{var a,i,o,c,l,d;const n=!r&&t.pC;r&&(t.pC||(t.pC=t.vC));let s;try{r||(r=typeof t.tag=="function"?Xn(e,t):He(t.props.children)),((a=r[0])==null?void 0:a.tag)===""&&r[0][vt]&&(s=r[0][vt],e[5].push([e,s,t]));const f=n?[...t.pC]:t.vC?[...t.vC]:void 0,p=[];let h;for(let y=0;y<r.length;y++){Array.isArray(r[y])&&r.splice(y,1,...r[y].flat());let g=es(r[y]);if(g){typeof g.tag=="function"&&!g.tag[ar]&&(Re.length>0&&(g[A][2]=Re.map(E=>[E,E.values.at(-1)])),(i=e[5])!=null&&i.length&&(g[A][3]=e[5].at(-1)));let m;if(f&&f.length){const E=f.findIndex(B(g)?R=>B(R):g.key!==void 0?R=>R.key===g.key&&R.tag===g.tag:R=>R.tag===g.tag);E!==-1&&(m=f[E],f.splice(E,1))}if(m)if(B(g))m.t!==g.t&&(m.t=g.t,m.d=!0),g=m;else{const E=m.pP=m.props;if(m.props=g.props,m.f||(m.f=g.f||t.f),typeof g.tag=="function"){const R=m[A][2];m[A][2]=g[A][2]||[],m[A][3]=g[A][3],!m.f&&((m.o||m)===g.o||(c=(o=m.tag)[Br])!=null&&c.call(o,E,m.props))&&Qn(R,m[A][2])&&(m.s=!0)}g=m}else if(!B(g)&&be){const E=Se(be);E&&(g.n=E)}if(!B(g)&&!g.s&&(wt(e,g),delete g.f),p.push(g),h&&!h.s&&!g.s)for(let E=h;E&&!B(E);E=(l=E.vC)==null?void 0:l.at(-1))E.nN=g;h=g}}t.vR=n?[...t.vC,...f||[]]:f||[],t.vC=p,n&&delete t.pC}catch(f){if(t.f=!0,f===Ut){if(s)return;throw f}const[p,h,y]=((d=t[A])==null?void 0:d[3])||[];if(h){const g=()=>et([0,!1,e[2]],y),m=Qe.get(y)||[];m.push(g),Qe.set(y,m);const E=h(f,()=>{const R=Qe.get(y);if(R){const j=R.indexOf(g);if(j!==-1)return R.splice(j,1),g()}});if(E){if(e[0]===1)e[1]=!0;else if(wt(e,y,[E]),(h.length===1||e!==p)&&y.c){Nr(y,y.c,!1);return}throw Ut}}throw f}finally{s&&e[5].pop()}},es=e=>{if(!(e==null||typeof e=="boolean")){if(typeof e=="string"||typeof e=="number")return{t:e.toString(),d:!0};if("vR"in e&&(e={tag:e.tag,props:e.props,key:e.key,f:e.f,type:e.tag,ref:e.props.ref,o:e.o||e}),typeof e.tag=="function")e[A]=[0,[]];else{const t=Kn[e.tag];t&&(be||(be=or("")),e.props.children=[{tag:be,props:{value:e.n=`http://www.w3.org/${t}`,children:e.props.children}}])}return e}},Wt=(e,t)=>{var r,n;(r=t[A][2])==null||r.forEach(([s,a])=>{s.values.push(a)});try{wt(e,t,void 0)}catch{return}if(t.a){delete t.a;return}(n=t[A][2])==null||n.forEach(([s])=>{s.values.pop()}),(e[0]!==1||!e[1])&&Nr(t,t.c,!1)},Ae=new WeakMap,zt=[],et=async(e,t)=>{e[5]||(e[5]=[]);const r=Ae.get(t);r&&r[0](void 0);let n;const s=new Promise(a=>n=a);if(Ae.set(t,[n,()=>{e[2]?e[2](e,t,a=>{Wt(a,t)}).then(()=>n(t)):(Wt(e,t),n(t))}]),zt.length)zt.at(-1).add(t);else{await Promise.resolve();const a=Ae.get(t);a&&(Ae.delete(t),a[1]())}return s},ts=(e,t,r)=>({tag:Ce,props:{children:e},key:r,e:t,p:1}),pt=0,Cr=1,ht=2,mt=3,yt=new WeakMap,qr=(e,t)=>!e||!t||e.length!==t.length||t.some((r,n)=>r!==e[n]),rs=void 0,Vt=[],ns=e=>{var i;const t=()=>typeof e=="function"?e():e,r=qe.at(-1);if(!r)return[t(),()=>{}];const[,n]=r,s=(i=n[A][1])[pt]||(i[pt]=[]),a=n[A][0]++;return s[a]||(s[a]=[t(),o=>{const c=rs,l=s[a];if(typeof o=="function"&&(o=o(l[0])),!Object.is(o,l[0]))if(l[0]=o,Vt.length){const[d,f]=Vt.at(-1);Promise.all([d===3?n:et([d,!1,c],n),f]).then(([p])=>{if(!p||!(d===2||d===3))return;const h=p.vC;requestAnimationFrame(()=>{setTimeout(()=>{h===p.vC&&et([d===3?1:0,!1,c],p)})})})}else et([0,!1,c],n)}])},xt=(e,t)=>{var o;const r=qe.at(-1);if(!r)return e;const[,n]=r,s=(o=n[A][1])[ht]||(o[ht]=[]),a=n[A][0]++,i=s[a];return qr(i==null?void 0:i[1],t)?s[a]=[e,t]:e=s[a][0],e},ss=e=>{const t=yt.get(e);if(t){if(t.length===2)throw t[1];return t[0]}throw e.then(r=>yt.set(e,[r]),r=>yt.set(e,[void 0,r])),e},as=(e,t)=>{var o;const r=qe.at(-1);if(!r)return e();const[,n]=r,s=(o=n[A][1])[mt]||(o[mt]=[]),a=n[A][0]++,i=s[a];return qr(i==null?void 0:i[1],t)&&(s[a]=[e(),t]),s[a][0]},is=or({pending:!1,data:null,method:null,action:null}),Jt=new Set,os=e=>{Jt.add(e),e.finally(()=>Jt.delete(e))},At=(e,t)=>as(()=>r=>{let n;e&&(typeof e=="function"?n=e(r)||(()=>{e(null)}):e&&"current"in e&&(e.current=r,n=()=>{e.current=null}));const s=t(r);return()=>{s==null||s(),n==null||n()}},[e]),de=Object.create(null),Ve=Object.create(null),Ue=(e,t,r,n,s)=>{if(t!=null&&t.itemProp)return{tag:e,props:t,type:e,ref:t.ref};const a=document.head;let{onLoad:i,onError:o,precedence:c,blocking:l,...d}=t,f=null,p=!1;const h=Je[e];let y;if(h.length>0){const R=a.querySelectorAll(e);e:for(const j of R)for(const O of Je[e])if(j.getAttribute(O)===t[O]){f=j;break e}if(!f){const j=h.reduce((O,x)=>t[x]===void 0?O:`${O}-${x}-${t[x]}`,e);p=!Ve[j],f=Ve[j]||(Ve[j]=(()=>{const O=document.createElement(e);for(const x of h)t[x]!==void 0&&O.setAttribute(x,t[x]),t.rel&&O.setAttribute("rel",t.rel);return O})())}}else y=a.querySelectorAll(e);c=n?c??"":void 0,n&&(d[Ke]=c);const g=xt(R=>{if(h.length>0){let j=!1;for(const O of a.querySelectorAll(e)){if(j&&O.getAttribute(Ke)!==c){a.insertBefore(R,O);return}O.getAttribute(Ke)===c&&(j=!0)}a.appendChild(R)}else if(y){let j=!1;for(const O of y)if(O===R){j=!0;break}j||a.insertBefore(R,a.contains(y[0])?y[0]:a.querySelector(e)),y=void 0}},[c]),m=At(t.ref,R=>{var x;const j=h[0];if(r===2&&(R.innerHTML=""),(p||y)&&g(R),!o&&!i)return;let O=de[x=R.getAttribute(j)]||(de[x]=new Promise((Oe,We)=>{R.addEventListener("load",Oe),R.addEventListener("error",We)}));i&&(O=O.then(i)),o&&(O=O.catch(o)),O.catch(()=>{})});if(s&&l==="render"){const R=Je[e][0];if(t[R]){const j=t[R],O=de[j]||(de[j]=new Promise((x,Oe)=>{g(f),f.addEventListener("load",x),f.addEventListener("error",Oe)}));ss(O)}}const E={tag:e,type:e,props:{...d,ref:m},ref:m};return E.p=r,f&&(E.e=f),ts(E,a)},cs=e=>{const t=Yn(),r=t&&Se(t);return r!=null&&r.endsWith("svg")?{tag:"title",props:e,type:"title",ref:e.ref}:Ue("title",e,void 0,!1,!1)},ls=e=>!e||["src","async"].some(t=>!e[t])?{tag:"script",props:e,type:"script",ref:e.ref}:Ue("script",e,1,!1,!0),us=e=>!e||!["href","precedence"].every(t=>t in e)?{tag:"style",props:e,type:"style",ref:e.ref}:(e["data-href"]=e.href,delete e.href,Ue("style",e,2,!0,!0)),ds=e=>!e||["onLoad","onError"].some(t=>t in e)||e.rel==="stylesheet"&&(!("precedence"in e)||"disabled"in e)?{tag:"link",props:e,type:"link",ref:e.ref}:Ue("link",e,1,"precedence"in e,!0),fs=e=>Ue("meta",e,void 0,!1,!1),Ir=Symbol(),ps=e=>{const{action:t,...r}=e;typeof t!="function"&&(r.action=t);const[n,s]=ns([null,!1]),a=xt(async l=>{const d=l.isTrusted?t:l.detail[Ir];if(typeof d!="function")return;l.preventDefault();const f=new FormData(l.target);s([f,!0]);const p=d(f);p instanceof Promise&&(os(p),await p),s([null,!0])},[]),i=At(e.ref,l=>(l.addEventListener("submit",a),()=>{l.removeEventListener("submit",a)})),[o,c]=n;return n[1]=!1,{tag:is,props:{value:{pending:o!==null,data:o,method:o?"post":null,action:o?t:null},children:{tag:"form",props:{...r,ref:i},type:"form",ref:i}},f:c}},Pr=(e,{formAction:t,...r})=>{if(typeof t=="function"){const n=xt(s=>{s.preventDefault(),s.currentTarget.form.dispatchEvent(new CustomEvent("submit",{detail:{[Ir]:t}}))},[]);r.ref=At(r.ref,s=>(s.addEventListener("click",n),()=>{s.removeEventListener("click",n)}))}return{tag:e,props:r,type:e,ref:r.ref}},hs=e=>Pr("input",e),ms=e=>Pr("button",e);Object.assign(gt,{title:cs,script:ls,style:us,link:ds,meta:fs,form:ps,input:hs,button:ms});bt(null);new TextEncoder;var ys=bt(null),vs=(e,t,r,n)=>(s,a)=>{const i="<!DOCTYPE html>",o=r?It(l=>r(l,e),{Layout:t,...a},s):s,c=$r`${F(i)}${It(ys.Provider,{value:e},o)}`;return e.html(c)},gs=(e,t)=>function(n,s){const a=n.getLayout()??tn;return e&&n.setLayout(i=>e({...i,Layout:a},n)),n.setRenderer(vs(n,a,e)),s()};const _s=gs(({children:e})=>I("html",{lang:"en",children:[I("head",{children:[I("meta",{charset:"UTF-8"}),I("meta",{name:"viewport",content:"width=device-width, initial-scale=1.0"}),I("title",{children:"TuloTech Africa - HR Management System"}),I("script",{src:"https://cdn.tailwindcss.com"}),I("link",{href:"https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css",rel:"stylesheet"}),I("style",{children:`
          @keyframes fade-in {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
          }
          .animate-fade-in {
            animation: fade-in 0.3s ease-out;
          }
          .nav-item {
            transition: all 0.2s ease;
          }
          .nav-item:hover {
            transform: translateX(5px);
          }
          @media print {
            .no-print { display: none !important; }
            body { background: white !important; }
          }
        `})]}),I("body",{class:"bg-gray-50",children:[e,I("script",{src:"/static/app.js"}),I("script",{src:"/static/app-views.js"}),I("script",{src:"/static/app-payslips.js"}),I("script",{src:"/static/app-calendar.js"})]})]})),b=new jr;b.use("/static/*",Vn({root:"./"}));b.use(_s);b.use("/api/*",Fn());b.post("/api/auth/login",async e=>{try{const{email:t,password:r}=await e.req.json(),n=await e.env.DB.prepare("SELECT * FROM users WHERE email = ? AND password_hash = ? AND is_active = 1").bind(t,r).first();if(!n)return e.json({error:"Invalid credentials"},401);const s=await e.env.DB.prepare("SELECT * FROM companies WHERE id = ?").bind(n.company_id).first();return e.json({success:!0,user:{id:n.id,email:n.email,first_name:n.first_name,last_name:n.last_name,role:n.role,company_id:n.company_id,company_name:s==null?void 0:s.name,organization_name:s==null?void 0:s.organization_name,employee_id:n.employee_id,department:n.department,position:n.position}})}catch{return e.json({error:"Login failed"},500)}});b.get("/api/companies",async e=>{try{const{results:t}=await e.env.DB.prepare("SELECT * FROM companies ORDER BY created_at DESC").all();return e.json({companies:t})}catch{return e.json({error:"Failed to fetch companies"},500)}});b.post("/api/companies",async e=>{try{const t=await e.req.json(),r=await e.env.DB.prepare(`
      INSERT INTO companies (name, organization_name, registration_number, address, contact_email, contact_phone)
      VALUES (?, ?, ?, ?, ?, ?)
    `).bind(t.name,t.organization_name||"TuloTech Africa",t.registration_number,t.address,t.contact_email,t.contact_phone).run();return e.json({success:!0,id:r.meta.last_row_id})}catch{return e.json({error:"Failed to create company"},500)}});b.get("/api/users",async e=>{try{const t=e.req.query("company_id"),r=e.req.query("role");let n="SELECT u.*, c.name as company_name FROM users u LEFT JOIN companies c ON u.company_id = c.id WHERE 1=1";const s=[];t&&(n+=" AND u.company_id = ?",s.push(t)),r&&(n+=" AND u.role = ?",s.push(r)),n+=" ORDER BY u.created_at DESC";const{results:a}=await e.env.DB.prepare(n).bind(...s).all();return e.json({users:a})}catch{return e.json({error:"Failed to fetch users"},500)}});b.get("/api/users/:id",async e=>{try{const t=e.req.param("id"),r=await e.env.DB.prepare("SELECT u.*, c.name as company_name FROM users u LEFT JOIN companies c ON u.company_id = c.id WHERE u.id = ?").bind(t).first();return r?e.json({user:r}):e.json({error:"User not found"},404)}catch{return e.json({error:"Failed to fetch user"},500)}});b.post("/api/users",async e=>{try{const t=await e.req.json(),r=await e.env.DB.prepare(`
      INSERT INTO users (company_id, email, password_hash, first_name, last_name, role, employee_id, department, position, hire_date, salary, phone, address)
      VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
    `).bind(t.company_id,t.email,t.password||"staff123",t.first_name,t.last_name,t.role||"staff",t.employee_id,t.department,t.position,t.hire_date,t.salary,t.phone,t.address).run();return e.json({success:!0,id:r.meta.last_row_id})}catch{return e.json({error:"Failed to create user"},500)}});b.put("/api/users/:id",async e=>{try{const t=e.req.param("id"),r=await e.req.json();return await e.env.DB.prepare(`
      UPDATE users SET 
        first_name = ?, last_name = ?, department = ?, position = ?, 
        salary = ?, phone = ?, address = ?, updated_at = CURRENT_TIMESTAMP
      WHERE id = ?
    `).bind(r.first_name,r.last_name,r.department,r.position,r.salary,r.phone,r.address,t).run(),e.json({success:!0})}catch{return e.json({error:"Failed to update user"},500)}});b.get("/api/attendance",async e=>{try{const t=e.req.query("user_id"),r=e.req.query("company_id"),n=e.req.query("date"),s=e.req.query("month");let a=`
      SELECT a.*, u.first_name, u.last_name, u.employee_id, u.department 
      FROM attendance a 
      JOIN users u ON a.user_id = u.id 
      WHERE 1=1
    `;const i=[];t&&(a+=" AND a.user_id = ?",i.push(t)),r&&(a+=" AND a.company_id = ?",i.push(r)),n&&(a+=" AND a.date = ?",i.push(n)),s&&(a+=' AND strftime("%Y-%m", a.date) = ?',i.push(s)),a+=" ORDER BY a.date DESC, a.clock_in DESC";const{results:o}=await e.env.DB.prepare(a).bind(...i).all();return e.json({attendance:o})}catch{return e.json({error:"Failed to fetch attendance"},500)}});b.post("/api/attendance/clock-in",async e=>{try{const{user_id:t,company_id:r}=await e.req.json(),n=new Date().toISOString().split("T")[0];if(await e.env.DB.prepare("SELECT * FROM attendance WHERE user_id = ? AND date = ?").bind(t,n).first())return e.json({error:"Already clocked in today"},400);const a=new Date().toISOString(),i=await e.env.DB.prepare(`
      INSERT INTO attendance (user_id, company_id, date, clock_in, status)
      VALUES (?, ?, ?, ?, 'present')
    `).bind(t,r,n,a).run();return e.json({success:!0,id:i.meta.last_row_id,clock_in:a})}catch{return e.json({error:"Failed to clock in"},500)}});b.post("/api/attendance/clock-out",async e=>{try{const{user_id:t}=await e.req.json(),r=new Date().toISOString().split("T")[0],n=new Date().toISOString();return(await e.env.DB.prepare(`
      UPDATE attendance SET clock_out = ?, updated_at = CURRENT_TIMESTAMP
      WHERE user_id = ? AND date = ?
    `).bind(n,t,r).run()).meta.changes===0?e.json({error:"No clock-in record found for today"},400):e.json({success:!0,clock_out:n})}catch{return e.json({error:"Failed to clock out"},500)}});b.post("/api/attendance",async e=>{try{const t=await e.req.json(),r=await e.env.DB.prepare(`
      INSERT INTO attendance (user_id, company_id, date, clock_in, clock_out, status, notes)
      VALUES (?, ?, ?, ?, ?, ?, ?)
    `).bind(t.user_id,t.company_id,t.date,t.clock_in,t.clock_out,t.status,t.notes).run();return e.json({success:!0,id:r.meta.last_row_id})}catch{return e.json({error:"Failed to create attendance record"},500)}});b.get("/api/payslips",async e=>{try{const t=e.req.query("user_id"),r=e.req.query("company_id"),n=e.req.query("year"),s=e.req.query("month");let a=`
      SELECT p.*, u.first_name, u.last_name, u.employee_id, u.department, u.position
      FROM payslips p
      JOIN users u ON p.user_id = u.id
      WHERE 1=1
    `;const i=[];t&&(a+=" AND p.user_id = ?",i.push(t)),r&&(a+=" AND p.company_id = ?",i.push(r)),n&&(a+=" AND p.year = ?",i.push(n)),s&&(a+=" AND p.month = ?",i.push(s)),a+=" ORDER BY p.year DESC, p.month DESC";const{results:o}=await e.env.DB.prepare(a).bind(...i).all();return e.json({payslips:o})}catch{return e.json({error:"Failed to fetch payslips"},500)}});b.get("/api/payslips/:id",async e=>{try{const t=e.req.param("id"),r=await e.env.DB.prepare(`
      SELECT p.*, u.first_name, u.last_name, u.employee_id, u.department, u.position, u.phone, u.address,
             c.name as company_name, c.organization_name, c.address as company_address, c.contact_email, c.contact_phone
      FROM payslips p
      JOIN users u ON p.user_id = u.id
      JOIN companies c ON p.company_id = c.id
      WHERE p.id = ?
    `).bind(t).first();return r?e.json({payslip:r}):e.json({error:"Payslip not found"},404)}catch{return e.json({error:"Failed to fetch payslip"},500)}});b.post("/api/payslips",async e=>{try{const t=await e.req.json(),r=parseFloat(t.basic_salary)+parseFloat(t.allowances||0)+parseFloat(t.bonuses||0)+parseFloat(t.overtime_pay||0),n=parseFloat(t.tax_deduction||0)+parseFloat(t.insurance_deduction||0)+parseFloat(t.pension_deduction||0)+parseFloat(t.other_deductions||0),s=r-n,a=await e.env.DB.prepare(`
      INSERT INTO payslips (
        user_id, company_id, month, year, basic_salary, allowances, bonuses, 
        overtime_hours, overtime_pay, gross_salary, tax_deduction, insurance_deduction,
        pension_deduction, other_deductions, total_deductions, net_salary, 
        payment_date, payment_method, bank_account, notes, generated_by
      ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
    `).bind(t.user_id,t.company_id,t.month,t.year,t.basic_salary,t.allowances||0,t.bonuses||0,t.overtime_hours||0,t.overtime_pay||0,r,t.tax_deduction||0,t.insurance_deduction||0,t.pension_deduction||0,t.other_deductions||0,n,s,t.payment_date,t.payment_method,t.bank_account,t.notes,t.generated_by).run();return e.json({success:!0,id:a.meta.last_row_id,gross_salary:r,total_deductions:n,net_salary:s})}catch{return e.json({error:"Failed to create payslip"},500)}});b.get("/api/leave-requests",async e=>{try{const t=e.req.query("user_id"),r=e.req.query("company_id"),n=e.req.query("status");let s=`
      SELECT lr.*, u.first_name, u.last_name, u.employee_id, u.department,
             approver.first_name as approver_first_name, approver.last_name as approver_last_name
      FROM leave_requests lr
      JOIN users u ON lr.user_id = u.id
      LEFT JOIN users approver ON lr.approved_by = approver.id
      WHERE 1=1
    `;const a=[];t&&(s+=" AND lr.user_id = ?",a.push(t)),r&&(s+=" AND lr.company_id = ?",a.push(r)),n&&(s+=" AND lr.status = ?",a.push(n)),s+=" ORDER BY lr.created_at DESC";const{results:i}=await e.env.DB.prepare(s).bind(...a).all();return e.json({leave_requests:i})}catch{return e.json({error:"Failed to fetch leave requests"},500)}});b.post("/api/leave-requests",async e=>{try{const t=await e.req.json(),r=new Date(t.start_date),n=new Date(t.end_date),s=Math.ceil((n.getTime()-r.getTime())/(1e3*60*60*24))+1,a=await e.env.DB.prepare(`
      INSERT INTO leave_requests (user_id, company_id, leave_type, start_date, end_date, days_count, reason)
      VALUES (?, ?, ?, ?, ?, ?, ?)
    `).bind(t.user_id,t.company_id,t.leave_type,t.start_date,t.end_date,s,t.reason).run();return e.json({success:!0,id:a.meta.last_row_id,days_count:s})}catch{return e.json({error:"Failed to create leave request"},500)}});b.put("/api/leave-requests/:id",async e=>{try{const t=e.req.param("id"),r=await e.req.json(),n=new Date().toISOString();return await e.env.DB.prepare(`
      UPDATE leave_requests SET 
        status = ?, approved_by = ?, approved_at = ?, notes = ?, updated_at = CURRENT_TIMESTAMP
      WHERE id = ?
    `).bind(r.status,r.approved_by,n,r.notes,t).run(),e.json({success:!0})}catch{return e.json({error:"Failed to update leave request"},500)}});b.get("/api/calendar-events",async e=>{try{const t=e.req.query("company_id"),r=e.req.query("month");let n=`
      SELECT ce.*, u.first_name as organizer_first_name, u.last_name as organizer_last_name
      FROM calendar_events ce
      LEFT JOIN users u ON ce.organizer_id = u.id
      WHERE 1=1
    `;const s=[];t&&(n+=" AND ce.company_id = ?",s.push(t)),r&&(n+=' AND strftime("%Y-%m", ce.start_date) = ?',s.push(r)),n+=" ORDER BY ce.start_date ASC";const{results:a}=await e.env.DB.prepare(n).bind(...s).all();return e.json({events:a})}catch{return e.json({error:"Failed to fetch calendar events"},500)}});b.post("/api/calendar-events",async e=>{try{const t=await e.req.json(),r=await e.env.DB.prepare(`
      INSERT INTO calendar_events (
        company_id, title, description, event_type, start_date, end_date, 
        is_all_day, location, organizer_id, is_public, color
      ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
    `).bind(t.company_id,t.title,t.description,t.event_type,t.start_date,t.end_date,t.is_all_day?1:0,t.location,t.organizer_id,t.is_public!==!1?1:0,t.color||"#3B82F6").run();return e.json({success:!0,id:r.meta.last_row_id})}catch{return e.json({error:"Failed to create calendar event"},500)}});b.delete("/api/calendar-events/:id",async e=>{try{const t=e.req.param("id");return await e.env.DB.prepare("DELETE FROM calendar_events WHERE id = ?").bind(t).run(),e.json({success:!0})}catch{return e.json({error:"Failed to delete calendar event"},500)}});b.get("/api/messages",async e=>{try{const t=e.req.query("user_id"),r=e.req.query("company_id"),n=e.req.query("announcement");let s=`
      SELECT m.*, 
             sender.first_name as sender_first_name, sender.last_name as sender_last_name,
             recipient.first_name as recipient_first_name, recipient.last_name as recipient_last_name
      FROM messages m
      JOIN users sender ON m.sender_id = sender.id
      LEFT JOIN users recipient ON m.recipient_id = recipient.id
      WHERE 1=1
    `;const a=[];r&&(s+=" AND m.company_id = ?",a.push(r)),n==="true"?s+=" AND m.is_announcement = 1":t&&(s+=" AND (m.recipient_id = ? OR m.sender_id = ? OR m.is_announcement = 1)",a.push(t,t)),s+=" ORDER BY m.created_at DESC";const{results:i}=await e.env.DB.prepare(s).bind(...a).all();return e.json({messages:i})}catch{return e.json({error:"Failed to fetch messages"},500)}});b.post("/api/messages",async e=>{try{const t=await e.req.json(),r=await e.env.DB.prepare(`
      INSERT INTO messages (
        company_id, sender_id, recipient_id, subject, message, 
        is_announcement, priority
      ) VALUES (?, ?, ?, ?, ?, ?, ?)
    `).bind(t.company_id,t.sender_id,t.recipient_id||null,t.subject,t.message,t.is_announcement?1:0,t.priority||"normal").run();return e.json({success:!0,id:r.meta.last_row_id})}catch{return e.json({error:"Failed to send message"},500)}});b.put("/api/messages/:id/read",async e=>{try{const t=e.req.param("id"),r=new Date().toISOString();return await e.env.DB.prepare(`
      UPDATE messages SET is_read = 1, read_at = ? WHERE id = ?
    `).bind(r,t).run(),e.json({success:!0})}catch{return e.json({error:"Failed to mark message as read"},500)}});b.get("/api/announcements",async e=>{try{const t=e.req.query("company_id");let r=`
      SELECT a.*, u.first_name, u.last_name
      FROM announcements a
      JOIN users u ON a.posted_by = u.id
      WHERE a.is_active = 1
    `;const n=[];t&&(r+=" AND a.company_id = ?",n.push(t)),r+=' AND (a.expires_at IS NULL OR a.expires_at > datetime("now"))',r+=" ORDER BY a.priority DESC, a.created_at DESC";const{results:s}=await e.env.DB.prepare(r).bind(...n).all();return e.json({announcements:s})}catch{return e.json({error:"Failed to fetch announcements"},500)}});b.post("/api/announcements",async e=>{try{const t=await e.req.json(),r=await e.env.DB.prepare(`
      INSERT INTO announcements (company_id, title, content, category, priority, posted_by, expires_at)
      VALUES (?, ?, ?, ?, ?, ?, ?)
    `).bind(t.company_id,t.title,t.content,t.category,t.priority||"normal",t.posted_by,t.expires_at||null).run();return e.json({success:!0,id:r.meta.last_row_id})}catch{return e.json({error:"Failed to create announcement"},500)}});b.get("/api/policy-documents",async e=>{try{const t=e.req.query("company_id");let r=`
      SELECT pd.id, pd.company_id, pd.title, pd.description, pd.category, 
             pd.file_type, pd.file_size, pd.version, pd.is_active, pd.created_at,
             u.first_name, u.last_name
      FROM policy_documents pd
      LEFT JOIN users u ON pd.uploaded_by = u.id
      WHERE pd.is_active = 1
    `;const n=[];t&&(r+=" AND pd.company_id = ?",n.push(t)),r+=" ORDER BY pd.created_at DESC";const{results:s}=await e.env.DB.prepare(r).bind(...n).all();return e.json({documents:s})}catch{return e.json({error:"Failed to fetch policy documents"},500)}});b.get("/api/policy-documents/:id",async e=>{try{const t=e.req.param("id"),r=await e.env.DB.prepare("SELECT * FROM policy_documents WHERE id = ? AND is_active = 1").bind(t).first();return r?e.json({document:r}):e.json({error:"Document not found"},404)}catch{return e.json({error:"Failed to fetch document"},500)}});b.get("/api/achievements",async e=>{try{const t=e.req.query("user_id"),r=e.req.query("company_id");let n=`
      SELECT a.*, u.first_name, u.last_name, u.employee_id,
             awarder.first_name as awarder_first_name, awarder.last_name as awarder_last_name
      FROM achievements a
      JOIN users u ON a.user_id = u.id
      LEFT JOIN users awarder ON a.awarded_by = awarder.id
      WHERE 1=1
    `;const s=[];t&&(n+=" AND a.user_id = ?",s.push(t)),r&&(n+=" AND a.company_id = ?",s.push(r)),n+=" ORDER BY a.created_at DESC";const{results:a}=await e.env.DB.prepare(n).bind(...s).all();return e.json({achievements:a})}catch{return e.json({error:"Failed to fetch achievements"},500)}});b.post("/api/achievements",async e=>{try{const t=await e.req.json(),r=await e.env.DB.prepare(`
      INSERT INTO achievements (user_id, company_id, achievement_type, title, description, icon, points, awarded_by)
      VALUES (?, ?, ?, ?, ?, ?, ?, ?)
    `).bind(t.user_id,t.company_id,t.achievement_type,t.title,t.description,t.icon||"",t.points||0,t.awarded_by).run();return e.json({success:!0,id:r.meta.last_row_id})}catch{return e.json({error:"Failed to create achievement"},500)}});b.get("/api/motivational-quote",async e=>{try{const{results:t}=await e.env.DB.prepare("SELECT * FROM motivational_quotes WHERE is_active = 1 ORDER BY RANDOM() LIMIT 1").all();return e.json({quote:t[0]||null})}catch{return e.json({error:"Failed to fetch quote"},500)}});b.get("/api/stats/dashboard",async e=>{try{const t=e.req.query("company_id"),r=e.req.query("user_id");if(!t)return e.json({error:"Company ID required"},400);const n=await e.env.DB.prepare('SELECT COUNT(*) as count FROM users WHERE company_id = ? AND is_active = 1 AND role = "staff"').bind(t).first(),s=new Date().toISOString().split("T")[0],a=await e.env.DB.prepare('SELECT COUNT(*) as count FROM attendance WHERE company_id = ? AND date = ? AND status = "present"').bind(t,s).first(),i=await e.env.DB.prepare('SELECT COUNT(*) as count FROM leave_requests WHERE company_id = ? AND status = "pending"').bind(t).first(),o=await e.env.DB.prepare('SELECT COUNT(*) as count FROM calendar_events WHERE company_id = ? AND start_date > datetime("now")').bind(t).first();return e.json({stats:{total_employees:(n==null?void 0:n.count)||0,present_today:(a==null?void 0:a.count)||0,pending_leaves:(i==null?void 0:i.count)||0,upcoming_events:(o==null?void 0:o.count)||0}})}catch{return e.json({error:"Failed to fetch statistics"},500)}});b.get("/",e=>e.render(I("div",{id:"app",class:"min-h-screen"})));const Kt=new jr,Es=Object.assign({"/src/index.tsx":b});let Fr=!1;for(const[,e]of Object.entries(Es))e&&(Kt.all("*",t=>{let r;try{r=t.executionCtx}catch{}return e.fetch(t.req.raw,t.env,r)}),Kt.notFound(t=>{let r;try{r=t.executionCtx}catch{}return e.fetch(t.req.raw,t.env,r)}),Fr=!0);if(!Fr)throw new Error("Can't import modules from ['/src/index.ts','/src/index.tsx','/app/server.ts']");export{Kt as default};
