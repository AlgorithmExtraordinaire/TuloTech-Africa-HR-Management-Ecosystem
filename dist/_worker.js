var kr=Object.defineProperty;var jt=e=>{throw TypeError(e)};var Hr=(e,t,r)=>t in e?kr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var _=(e,t,r)=>Hr(e,typeof t!="symbol"?t+"":t,r),ot=(e,t,r)=>t.has(e)||jt("Cannot "+r);var u=(e,t,r)=>(ot(e,t,"read from private field"),r?r.call(e):t.get(e)),w=(e,t,r)=>t.has(e)?jt("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),g=(e,t,r,n)=>(ot(e,t,"write to private field"),n?n.call(e,r):t.set(e,r),r),S=(e,t,r)=>(ot(e,t,"access private method"),r);var Dt=(e,t,r,n)=>({set _(a){g(e,t,a,r)},get _(){return u(e,t,n)}});var tr={Stringify:1},P=(e,t)=>{const r=new String(e);return r.isEscaped=!0,r.callbacks=t,r},Br=/[&<>'"]/,rr=async(e,t)=>{let r="";t||(t=[]);const n=await Promise.all(e);for(let a=n.length-1;r+=n[a],a--,!(a<0);a--){let s=n[a];typeof s=="object"&&t.push(...s.callbacks||[]);const i=s.isEscaped;if(s=await(typeof s=="object"?s.toString():s),typeof s=="object"&&t.push(...s.callbacks||[]),s.isEscaped??i)r+=s;else{const o=[r];te(s,o),r=o[0]}}return P(r,t)},te=(e,t)=>{const r=e.search(Br);if(r===-1){t[0]+=e;return}let n,a,s=0;for(a=r;a<e.length;a++){switch(e.charCodeAt(a)){case 34:n="&quot;";break;case 39:n="&#39;";break;case 38:n="&amp;";break;case 60:n="&lt;";break;case 62:n="&gt;";break;default:continue}t[0]+=e.substring(s,a)+n,s=a+1}t[0]+=e.substring(s,a)},nr=e=>{const t=e.callbacks;if(!(t!=null&&t.length))return e;const r=[e],n={};return t.forEach(a=>a({phase:tr.Stringify,buffer:r,context:n})),r[0]},ar=async(e,t,r,n,a)=>{typeof e=="object"&&!(e instanceof String)&&(e instanceof Promise||(e=e.toString()),e instanceof Promise&&(e=await e));const s=e.callbacks;return s!=null&&s.length?(a?a[0]+=e:a=[e],Promise.all(s.map(o=>o({phase:t,buffer:a,context:n}))).then(o=>Promise.all(o.filter(Boolean).map(c=>ar(c,t,!1,n,a))).then(()=>a[0]))):Promise.resolve(e)},$r=(e,...t)=>{const r=[""];for(let n=0,a=e.length-1;n<a;n++){r[0]+=e[n];const s=Array.isArray(t[n])?t[n].flat(1/0):[t[n]];for(let i=0,o=s.length;i<o;i++){const c=s[i];if(typeof c=="string")te(c,r);else if(typeof c=="number")r[0]+=c;else{if(typeof c=="boolean"||c===null||c===void 0)continue;if(typeof c=="object"&&c.isEscaped)if(c.callbacks)r.unshift("",c);else{const l=c.toString();l instanceof Promise?r.unshift("",l):r[0]+=l}else c instanceof Promise?r.unshift("",c):te(c.toString(),r)}}}return r[0]+=e.at(-1),r.length===1?"callbacks"in r?P(nr(P(r[0],r.callbacks))):P(r[0]):rr(r,r.callbacks)},bt=Symbol("RENDERER"),_t=Symbol("ERROR_HANDLER"),N=Symbol("STASH"),sr=Symbol("INTERNAL"),Ur=Symbol("MEMO"),tt=Symbol("PERMALINK"),At=e=>(e[sr]=!0,e),ir=e=>({value:t,children:r})=>{if(!r)return;const n={children:[{tag:At(()=>{e.push(t)}),props:{}}]};Array.isArray(r)?n.children.push(...r.flat()):n.children.push(r),n.children.push({tag:At(()=>{e.pop()}),props:{}});const a={tag:"",props:n,type:""};return a[_t]=s=>{throw e.pop(),s},a},or=e=>{const t=[e],r=ir(t);return r.values=t,r.Provider=r,be.push(r),r},be=[],Rt=e=>{const t=[e],r=(n=>{t.push(n.value);let a;try{a=n.children?(Array.isArray(n.children)?new dr("",{},n.children):n.children).toString():""}catch(s){throw t.pop(),s}return a instanceof Promise?a.finally(()=>t.pop()).then(s=>P(s,s.callbacks)):(t.pop(),P(a))});return r.values=t,r.Provider=r,r[bt]=ir(t),be.push(r),r},Se=e=>e.values.at(-1),Je={title:[],script:["src"],style:["data-href"],link:["href"],meta:["name","httpEquiv","charset","itemProp"]},vt={},Ve="data-precedence",He=e=>Array.isArray(e)?e:[e],Ct=new WeakMap,It=(e,t,r,n)=>({buffer:a,context:s})=>{if(!a)return;const i=Ct.get(s)||{};Ct.set(s,i);const o=i[e]||(i[e]=[]);let c=!1;const l=Je[e];if(l.length>0){e:for(const[,d]of o)for(const f of l)if(((d==null?void 0:d[f])??null)===(r==null?void 0:r[f])){c=!0;break e}}if(c?a[0]=a[0].replaceAll(t,""):l.length>0?o.push([t,r,n]):o.unshift([t,r,n]),a[0].indexOf("</head>")!==-1){let d;if(n===void 0)d=o.map(([f])=>f);else{const f=[];d=o.map(([p,,h])=>{let y=f.indexOf(h);return y===-1&&(f.push(h),y=f.length-1),[p,y]}).sort((p,h)=>p[1]-h[1]).map(([p])=>p)}d.forEach(f=>{a[0]=a[0].replaceAll(f,"")}),a[0]=a[0].replace(/(?=<\/head>)/,d.join(""))}},Be=(e,t,r)=>P(new H(e,r,He(t??[])).toString()),$e=(e,t,r,n)=>{if("itemProp"in r)return Be(e,t,r);let{precedence:a,blocking:s,...i}=r;a=n?a??"":void 0,n&&(i[Ve]=a);const o=new H(e,i,He(t||[])).toString();return o instanceof Promise?o.then(c=>P(o,[...c.callbacks||[],It(e,c,i,a)])):P(o,[It(e,o,i,a)])},Wr=({children:e,...t})=>{const r=St();if(r){const n=Se(r);if(n==="svg"||n==="head")return new H("title",t,He(e??[]))}return $e("title",e,t,!1)},Yr=({children:e,...t})=>{const r=St();return["src","async"].some(n=>!t[n])||r&&Se(r)==="head"?Be("script",e,t):$e("script",e,t,!1)},zr=({children:e,...t})=>["href","precedence"].every(r=>r in t)?(t["data-href"]=t.href,delete t.href,$e("style",e,t,!0)):Be("style",e,t),Jr=({children:e,...t})=>["onLoad","onError"].some(r=>r in t)||t.rel==="stylesheet"&&(!("precedence"in t)||"disabled"in t)?Be("link",e,t):$e("link",e,t,"precedence"in t),Vr=({children:e,...t})=>{const r=St();return r&&Se(r)==="head"?Be("meta",e,t):$e("meta",e,t,!1)},cr=(e,{children:t,...r})=>new H(e,r,He(t??[])),Kr=e=>(typeof e.action=="function"&&(e.action=tt in e.action?e.action[tt]:void 0),cr("form",e)),lr=(e,t)=>(typeof t.formAction=="function"&&(t.formAction=tt in t.formAction?t.formAction[tt]:void 0),cr(e,t)),Gr=e=>lr("input",e),Xr=e=>lr("button",e);const ct=Object.freeze(Object.defineProperty({__proto__:null,button:Xr,form:Kr,input:Gr,link:Jr,meta:Vr,script:Yr,style:zr,title:Wr},Symbol.toStringTag,{value:"Module"}));var Zr=new Map([["className","class"],["htmlFor","for"],["crossOrigin","crossorigin"],["httpEquiv","http-equiv"],["itemProp","itemprop"],["fetchPriority","fetchpriority"],["noModule","nomodule"],["formAction","formaction"]]),rt=e=>Zr.get(e)||e,ur=(e,t)=>{for(const[r,n]of Object.entries(e)){const a=r[0]==="-"||!/[A-Z]/.test(r)?r:r.replace(/[A-Z]/g,s=>`-${s.toLowerCase()}`);t(a,n==null?null:typeof n=="number"?a.match(/^(?:a|border-im|column(?:-c|s)|flex(?:$|-[^b])|grid-(?:ar|[^a])|font-w|li|or|sca|st|ta|wido|z)|ty$/)?`${n}`:`${n}px`:n)}},Ae=void 0,St=()=>Ae,Qr=e=>/[A-Z]/.test(e)&&e.match(/^(?:al|basel|clip(?:Path|Rule)$|co|do|fill|fl|fo|gl|let|lig|i|marker[EMS]|o|pai|pointe|sh|st[or]|text[^L]|tr|u|ve|w)/)?e.replace(/([A-Z])/g,"-$1").toLowerCase():e,en=["area","base","br","col","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"],tn=["allowfullscreen","async","autofocus","autoplay","checked","controls","default","defer","disabled","download","formnovalidate","hidden","inert","ismap","itemscope","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"],Ot=(e,t)=>{for(let r=0,n=e.length;r<n;r++){const a=e[r];if(typeof a=="string")te(a,t);else{if(typeof a=="boolean"||a===null||a===void 0)continue;a instanceof H?a.toStringToBuffer(t):typeof a=="number"||a.isEscaped?t[0]+=a:a instanceof Promise?t.unshift("",a):Ot(a,t)}}},H=class{constructor(e,t,r){_(this,"tag");_(this,"props");_(this,"key");_(this,"children");_(this,"isEscaped",!0);_(this,"localContexts");this.tag=e,this.props=t,this.children=r}get type(){return this.tag}get ref(){return this.props.ref||null}toString(){var t,r;const e=[""];(t=this.localContexts)==null||t.forEach(([n,a])=>{n.values.push(a)});try{this.toStringToBuffer(e)}finally{(r=this.localContexts)==null||r.forEach(([n])=>{n.values.pop()})}return e.length===1?"callbacks"in e?nr(P(e[0],e.callbacks)).toString():e[0]:rr(e,e.callbacks)}toStringToBuffer(e){const t=this.tag,r=this.props;let{children:n}=this;e[0]+=`<${t}`;const a=Ae&&Se(Ae)==="svg"?s=>Qr(rt(s)):s=>rt(s);for(let[s,i]of Object.entries(r))if(s=a(s),s!=="children"){if(s==="style"&&typeof i=="object"){let o="";ur(i,(c,l)=>{l!=null&&(o+=`${o?";":""}${c}:${l}`)}),e[0]+=' style="',te(o,e),e[0]+='"'}else if(typeof i=="string")e[0]+=` ${s}="`,te(i,e),e[0]+='"';else if(i!=null)if(typeof i=="number"||i.isEscaped)e[0]+=` ${s}="${i}"`;else if(typeof i=="boolean"&&tn.includes(s))i&&(e[0]+=` ${s}=""`);else if(s==="dangerouslySetInnerHTML"){if(n.length>0)throw new Error("Can only set one of `children` or `props.dangerouslySetInnerHTML`.");n=[P(i.__html)]}else if(i instanceof Promise)e[0]+=` ${s}="`,e.unshift('"',i);else if(typeof i=="function"){if(!s.startsWith("on")&&s!=="ref")throw new Error(`Invalid prop '${s}' of type 'function' supplied to '${t}'.`)}else e[0]+=` ${s}="`,te(i.toString(),e),e[0]+='"'}if(en.includes(t)&&n.length===0){e[0]+="/>";return}e[0]+=">",Ot(n,e),e[0]+=`</${t}>`}},lt=class extends H{toStringToBuffer(e){const{children:t}=this,r={...this.props};t.length&&(r.children=t.length===1?t[0]:t);const n=this.tag.call(null,r);if(!(typeof n=="boolean"||n==null))if(n instanceof Promise)if(be.length===0)e.unshift("",n);else{const a=be.map(s=>[s,s.values.at(-1)]);e.unshift("",n.then(s=>(s instanceof H&&(s.localContexts=a),s)))}else n instanceof H?n.toStringToBuffer(e):typeof n=="number"||n.isEscaped?(e[0]+=n,n.callbacks&&(e.callbacks||(e.callbacks=[]),e.callbacks.push(...n.callbacks))):te(n,e)}},dr=class extends H{toStringToBuffer(e){Ot(this.children,e)}},Ft=(e,t,...r)=>{t??(t={}),r.length&&(t.children=r.length===1?r[0]:r);const n=t.key;delete t.key;const a=Ke(e,t,r);return a.key=n,a},qt=!1,Ke=(e,t,r)=>{if(!qt){for(const n in vt)ct[n][bt]=vt[n];qt=!0}return typeof e=="function"?new lt(e,t,r):ct[e]?new lt(ct[e],t,r):e==="svg"||e==="head"?(Ae||(Ae=Rt("")),new H(e,t,[new lt(Ae,{value:e},r)])):new H(e,t,r)},rn=({children:e})=>new dr("",{children:e},Array.isArray(e)?e:e?[e]:[]);function F(e,t,r){let n;if(!t||!("children"in t))n=Ke(e,t,[]);else{const a=t.children;n=Array.isArray(a)?Ke(e,t,a):Ke(e,t,[a])}return n.key=r,n}var Pt=(e,t,r)=>(n,a)=>{let s=-1;return i(0);async function i(o){if(o<=s)throw new Error("next() called multiple times");s=o;let c,l=!1,d;if(e[o]?(d=e[o][0][0],n.req.routeIndex=o):d=o===e.length&&a||void 0,d)try{c=await d(n,()=>i(o+1))}catch(f){if(f instanceof Error&&t)n.error=f,c=await t(f,n),l=!0;else throw f}else n.finalized===!1&&r&&(c=await r(n));return c&&(n.finalized===!1||l)&&(n.res=c),n}},nn=Symbol(),an=async(e,t=Object.create(null))=>{const{all:r=!1,dot:n=!1}=t,s=(e instanceof _r?e.raw.headers:e.headers).get("Content-Type");return s!=null&&s.startsWith("multipart/form-data")||s!=null&&s.startsWith("application/x-www-form-urlencoded")?sn(e,{all:r,dot:n}):{}};async function sn(e,t){const r=await e.formData();return r?on(r,t):{}}function on(e,t){const r=Object.create(null);return e.forEach((n,a)=>{t.all||a.endsWith("[]")?cn(r,a,n):r[a]=n}),t.dot&&Object.entries(r).forEach(([n,a])=>{n.includes(".")&&(ln(r,n,a),delete r[n])}),r}var cn=(e,t,r)=>{e[t]!==void 0?Array.isArray(e[t])?e[t].push(r):e[t]=[e[t],r]:t.endsWith("[]")?e[t]=[r]:e[t]=r},ln=(e,t,r)=>{let n=e;const a=t.split(".");a.forEach((s,i)=>{i===a.length-1?n[s]=r:((!n[s]||typeof n[s]!="object"||Array.isArray(n[s])||n[s]instanceof File)&&(n[s]=Object.create(null)),n=n[s])})},fr=e=>{const t=e.split("/");return t[0]===""&&t.shift(),t},un=e=>{const{groups:t,path:r}=dn(e),n=fr(r);return fn(n,t)},dn=e=>{const t=[];return e=e.replace(/\{[^}]+\}/g,(r,n)=>{const a=`@${n}`;return t.push([a,r]),a}),{groups:t,path:e}},fn=(e,t)=>{for(let r=t.length-1;r>=0;r--){const[n]=t[r];for(let a=e.length-1;a>=0;a--)if(e[a].includes(n)){e[a]=e[a].replace(n,t[r][1]);break}}return e},Ye={},pn=(e,t)=>{if(e==="*")return"*";const r=e.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);if(r){const n=`${e}#${t}`;return Ye[n]||(r[2]?Ye[n]=t&&t[0]!==":"&&t[0]!=="*"?[n,r[1],new RegExp(`^${r[2]}(?=/${t})`)]:[e,r[1],new RegExp(`^${r[2]}$`)]:Ye[n]=[e,r[1],!0]),Ye[n]}return null},Tt=(e,t)=>{try{return t(e)}catch{return e.replace(/(?:%[0-9A-Fa-f]{2})+/g,r=>{try{return t(r)}catch{return r}})}},hn=e=>Tt(e,decodeURI),pr=e=>{const t=e.url,r=t.indexOf("/",t.indexOf(":")+4);let n=r;for(;n<t.length;n++){const a=t.charCodeAt(n);if(a===37){const s=t.indexOf("?",n),i=t.indexOf("#",n),o=s===-1?i===-1?void 0:i:i===-1?s:Math.min(s,i),c=t.slice(r,o);return hn(c.includes("%25")?c.replace(/%25/g,"%2525"):c)}else if(a===63||a===35)break}return t.slice(r,n)},mn=e=>{const t=pr(e);return t.length>1&&t.at(-1)==="/"?t.slice(0,-1):t},fe=(e,t,...r)=>(r.length&&(t=fe(t,...r)),`${(e==null?void 0:e[0])==="/"?"":"/"}${e}${t==="/"?"":`${(e==null?void 0:e.at(-1))==="/"?"":"/"}${(t==null?void 0:t[0])==="/"?t.slice(1):t}`}`),hr=e=>{if(e.charCodeAt(e.length-1)!==63||!e.includes(":"))return null;const t=e.split("/"),r=[];let n="";return t.forEach(a=>{if(a!==""&&!/\:/.test(a))n+="/"+a;else if(/\:/.test(a))if(/\?/.test(a)){r.length===0&&n===""?r.push("/"):r.push(n);const s=a.replace("?","");n+="/"+s,r.push(n)}else n+="/"+a}),r.filter((a,s,i)=>i.indexOf(a)===s)},ut=e=>/[%+]/.test(e)?(e.indexOf("+")!==-1&&(e=e.replace(/\+/g," ")),e.indexOf("%")!==-1?Tt(e,yr):e):e,mr=(e,t,r)=>{let n;if(!r&&t&&!/[%+]/.test(t)){let i=e.indexOf("?",8);if(i===-1)return;for(e.startsWith(t,i+1)||(i=e.indexOf(`&${t}`,i+1));i!==-1;){const o=e.charCodeAt(i+t.length+1);if(o===61){const c=i+t.length+2,l=e.indexOf("&",c);return ut(e.slice(c,l===-1?void 0:l))}else if(o==38||isNaN(o))return"";i=e.indexOf(`&${t}`,i+1)}if(n=/[%+]/.test(e),!n)return}const a={};n??(n=/[%+]/.test(e));let s=e.indexOf("?",8);for(;s!==-1;){const i=e.indexOf("&",s+1);let o=e.indexOf("=",s);o>i&&i!==-1&&(o=-1);let c=e.slice(s+1,o===-1?i===-1?void 0:i:o);if(n&&(c=ut(c)),s=i,c==="")continue;let l;o===-1?l="":(l=e.slice(o+1,i===-1?void 0:i),n&&(l=ut(l))),r?(a[c]&&Array.isArray(a[c])||(a[c]=[]),a[c].push(l)):a[c]??(a[c]=l)}return t?a[t]:a},yn=mr,_n=(e,t)=>mr(e,t,!0),yr=decodeURIComponent,Lt=e=>Tt(e,yr),me,q,J,vr,gr,gt,K,Kt,_r=(Kt=class{constructor(e,t="/",r=[[]]){w(this,J);_(this,"raw");w(this,me);w(this,q);_(this,"routeIndex",0);_(this,"path");_(this,"bodyCache",{});w(this,K,e=>{const{bodyCache:t,raw:r}=this,n=t[e];if(n)return n;const a=Object.keys(t)[0];return a?t[a].then(s=>(a==="json"&&(s=JSON.stringify(s)),new Response(s)[e]())):t[e]=r[e]()});this.raw=e,this.path=t,g(this,q,r),g(this,me,{})}param(e){return e?S(this,J,vr).call(this,e):S(this,J,gr).call(this)}query(e){return yn(this.url,e)}queries(e){return _n(this.url,e)}header(e){if(e)return this.raw.headers.get(e)??void 0;const t={};return this.raw.headers.forEach((r,n)=>{t[n]=r}),t}async parseBody(e){var t;return(t=this.bodyCache).parsedBody??(t.parsedBody=await an(this,e))}json(){return u(this,K).call(this,"text").then(e=>JSON.parse(e))}text(){return u(this,K).call(this,"text")}arrayBuffer(){return u(this,K).call(this,"arrayBuffer")}blob(){return u(this,K).call(this,"blob")}formData(){return u(this,K).call(this,"formData")}addValidatedData(e,t){u(this,me)[e]=t}valid(e){return u(this,me)[e]}get url(){return this.raw.url}get method(){return this.raw.method}get[nn](){return u(this,q)}get matchedRoutes(){return u(this,q)[0].map(([[,e]])=>e)}get routePath(){return u(this,q)[0].map(([[,e]])=>e)[this.routeIndex].path}},me=new WeakMap,q=new WeakMap,J=new WeakSet,vr=function(e){const t=u(this,q)[0][this.routeIndex][1][e],r=S(this,J,gt).call(this,t);return r&&/\%/.test(r)?Lt(r):r},gr=function(){const e={},t=Object.keys(u(this,q)[0][this.routeIndex][1]);for(const r of t){const n=S(this,J,gt).call(this,u(this,q)[0][this.routeIndex][1][r]);n!==void 0&&(e[r]=/\%/.test(n)?Lt(n):n)}return e},gt=function(e){return u(this,q)[1]?u(this,q)[1][e]:e},K=new WeakMap,Kt),vn="text/plain; charset=UTF-8",dt=(e,t)=>({"Content-Type":e,...t}),Fe,qe,U,ye,W,I,Pe,_e,ve,ae,Le,Me,G,pe,Gt,gn=(Gt=class{constructor(e,t){w(this,G);w(this,Fe);w(this,qe);_(this,"env",{});w(this,U);_(this,"finalized",!1);_(this,"error");w(this,ye);w(this,W);w(this,I);w(this,Pe);w(this,_e);w(this,ve);w(this,ae);w(this,Le);w(this,Me);_(this,"render",(...e)=>(u(this,_e)??g(this,_e,t=>this.html(t)),u(this,_e).call(this,...e)));_(this,"setLayout",e=>g(this,Pe,e));_(this,"getLayout",()=>u(this,Pe));_(this,"setRenderer",e=>{g(this,_e,e)});_(this,"header",(e,t,r)=>{this.finalized&&g(this,I,new Response(u(this,I).body,u(this,I)));const n=u(this,I)?u(this,I).headers:u(this,ae)??g(this,ae,new Headers);t===void 0?n.delete(e):r!=null&&r.append?n.append(e,t):n.set(e,t)});_(this,"status",e=>{g(this,ye,e)});_(this,"set",(e,t)=>{u(this,U)??g(this,U,new Map),u(this,U).set(e,t)});_(this,"get",e=>u(this,U)?u(this,U).get(e):void 0);_(this,"newResponse",(...e)=>S(this,G,pe).call(this,...e));_(this,"body",(e,t,r)=>S(this,G,pe).call(this,e,t,r));_(this,"text",(e,t,r)=>!u(this,ae)&&!u(this,ye)&&!t&&!r&&!this.finalized?new Response(e):S(this,G,pe).call(this,e,t,dt(vn,r)));_(this,"json",(e,t,r)=>S(this,G,pe).call(this,JSON.stringify(e),t,dt("application/json",r)));_(this,"html",(e,t,r)=>{const n=a=>S(this,G,pe).call(this,a,t,dt("text/html; charset=UTF-8",r));return typeof e=="object"?ar(e,tr.Stringify,!1,{}).then(n):n(e)});_(this,"redirect",(e,t)=>{const r=String(e);return this.header("Location",/[^\x00-\xFF]/.test(r)?encodeURI(r):r),this.newResponse(null,t??302)});_(this,"notFound",()=>(u(this,ve)??g(this,ve,()=>new Response),u(this,ve).call(this,this)));g(this,Fe,e),t&&(g(this,W,t.executionCtx),this.env=t.env,g(this,ve,t.notFoundHandler),g(this,Me,t.path),g(this,Le,t.matchResult))}get req(){return u(this,qe)??g(this,qe,new _r(u(this,Fe),u(this,Me),u(this,Le))),u(this,qe)}get event(){if(u(this,W)&&"respondWith"in u(this,W))return u(this,W);throw Error("This context has no FetchEvent")}get executionCtx(){if(u(this,W))return u(this,W);throw Error("This context has no ExecutionContext")}get res(){return u(this,I)||g(this,I,new Response(null,{headers:u(this,ae)??g(this,ae,new Headers)}))}set res(e){if(u(this,I)&&e){e=new Response(e.body,e);for(const[t,r]of u(this,I).headers.entries())if(t!=="content-type")if(t==="set-cookie"){const n=u(this,I).headers.getSetCookie();e.headers.delete("set-cookie");for(const a of n)e.headers.append("set-cookie",a)}else e.headers.set(t,r)}g(this,I,e),this.finalized=!0}get var(){return u(this,U)?Object.fromEntries(u(this,U)):{}}},Fe=new WeakMap,qe=new WeakMap,U=new WeakMap,ye=new WeakMap,W=new WeakMap,I=new WeakMap,Pe=new WeakMap,_e=new WeakMap,ve=new WeakMap,ae=new WeakMap,Le=new WeakMap,Me=new WeakMap,G=new WeakSet,pe=function(e,t,r){const n=u(this,I)?new Headers(u(this,I).headers):u(this,ae)??new Headers;if(typeof t=="object"&&"headers"in t){const s=t.headers instanceof Headers?t.headers:new Headers(t.headers);for(const[i,o]of s)i.toLowerCase()==="set-cookie"?n.append(i,o):n.set(i,o)}if(r)for(const[s,i]of Object.entries(r))if(typeof i=="string")n.set(s,i);else{n.delete(s);for(const o of i)n.append(s,o)}const a=typeof t=="number"?t:(t==null?void 0:t.status)??u(this,ye);return new Response(e,{status:a,headers:n})},Gt),j="ALL",En="all",wn=["get","post","put","delete","options","patch"],Er="Can not add a route since the matcher is already built.",wr=class extends Error{},bn="__COMPOSED_HANDLER",Rn=e=>e.text("404 Not Found",404),Mt=(e,t)=>{if("getResponse"in e){const r=e.getResponse();return t.newResponse(r.body,r)}return console.error(e),t.text("Internal Server Error",500)},L,D,br,M,re,Ge,Xe,ge,Sn=(ge=class{constructor(t={}){w(this,D);_(this,"get");_(this,"post");_(this,"put");_(this,"delete");_(this,"options");_(this,"patch");_(this,"all");_(this,"on");_(this,"use");_(this,"router");_(this,"getPath");_(this,"_basePath","/");w(this,L,"/");_(this,"routes",[]);w(this,M,Rn);_(this,"errorHandler",Mt);_(this,"onError",t=>(this.errorHandler=t,this));_(this,"notFound",t=>(g(this,M,t),this));_(this,"fetch",(t,...r)=>S(this,D,Xe).call(this,t,r[1],r[0],t.method));_(this,"request",(t,r,n,a)=>t instanceof Request?this.fetch(r?new Request(t,r):t,n,a):(t=t.toString(),this.fetch(new Request(/^https?:\/\//.test(t)?t:`http://localhost${fe("/",t)}`,r),n,a)));_(this,"fire",()=>{addEventListener("fetch",t=>{t.respondWith(S(this,D,Xe).call(this,t.request,t,void 0,t.request.method))})});[...wn,En].forEach(s=>{this[s]=(i,...o)=>(typeof i=="string"?g(this,L,i):S(this,D,re).call(this,s,u(this,L),i),o.forEach(c=>{S(this,D,re).call(this,s,u(this,L),c)}),this)}),this.on=(s,i,...o)=>{for(const c of[i].flat()){g(this,L,c);for(const l of[s].flat())o.map(d=>{S(this,D,re).call(this,l.toUpperCase(),u(this,L),d)})}return this},this.use=(s,...i)=>(typeof s=="string"?g(this,L,s):(g(this,L,"*"),i.unshift(s)),i.forEach(o=>{S(this,D,re).call(this,j,u(this,L),o)}),this);const{strict:n,...a}=t;Object.assign(this,a),this.getPath=n??!0?t.getPath??pr:mn}route(t,r){const n=this.basePath(t);return r.routes.map(a=>{var i;let s;r.errorHandler===Mt?s=a.handler:(s=async(o,c)=>(await Pt([],r.errorHandler)(o,()=>a.handler(o,c))).res,s[bn]=a.handler),S(i=n,D,re).call(i,a.method,a.path,s)}),this}basePath(t){const r=S(this,D,br).call(this);return r._basePath=fe(this._basePath,t),r}mount(t,r,n){let a,s;n&&(typeof n=="function"?s=n:(s=n.optionHandler,n.replaceRequest===!1?a=c=>c:a=n.replaceRequest));const i=s?c=>{const l=s(c);return Array.isArray(l)?l:[l]}:c=>{let l;try{l=c.executionCtx}catch{}return[c.env,l]};a||(a=(()=>{const c=fe(this._basePath,t),l=c==="/"?0:c.length;return d=>{const f=new URL(d.url);return f.pathname=f.pathname.slice(l)||"/",new Request(f,d)}})());const o=async(c,l)=>{const d=await r(a(c.req.raw),...i(c));if(d)return d;await l()};return S(this,D,re).call(this,j,fe(t,"*"),o),this}},L=new WeakMap,D=new WeakSet,br=function(){const t=new ge({router:this.router,getPath:this.getPath});return t.errorHandler=this.errorHandler,g(t,M,u(this,M)),t.routes=this.routes,t},M=new WeakMap,re=function(t,r,n){t=t.toUpperCase(),r=fe(this._basePath,r);const a={basePath:this._basePath,path:r,method:t,handler:n};this.router.add(t,r,[n,a]),this.routes.push(a)},Ge=function(t,r){if(t instanceof Error)return this.errorHandler(t,r);throw t},Xe=function(t,r,n,a){if(a==="HEAD")return(async()=>new Response(null,await S(this,D,Xe).call(this,t,r,n,"GET")))();const s=this.getPath(t,{env:n}),i=this.router.match(a,s),o=new gn(t,{path:s,matchResult:i,env:n,executionCtx:r,notFoundHandler:u(this,M)});if(i[0].length===1){let l;try{l=i[0][0][0][0](o,async()=>{o.res=await u(this,M).call(this,o)})}catch(d){return S(this,D,Ge).call(this,d,o)}return l instanceof Promise?l.then(d=>d||(o.finalized?o.res:u(this,M).call(this,o))).catch(d=>S(this,D,Ge).call(this,d,o)):l??u(this,M).call(this,o)}const c=Pt(i[0],this.errorHandler,u(this,M));return(async()=>{try{const l=await c(o);if(!l.finalized)throw new Error("Context is not finalized. Did you forget to return a Response object or `await next()`?");return l.res}catch(l){return S(this,D,Ge).call(this,l,o)}})()},ge),Rr=[];function On(e,t){const r=this.buildAllMatchers(),n=((a,s)=>{const i=r[a]||r[j],o=i[2][s];if(o)return o;const c=s.match(i[0]);if(!c)return[[],Rr];const l=c.indexOf("",1);return[i[1][l],c]});return this.match=n,n(e,t)}var nt="[^/]+",je=".*",De="(?:|/.*)",he=Symbol(),Tn=new Set(".\\+*[^]$()");function xn(e,t){return e.length===1?t.length===1?e<t?-1:1:-1:t.length===1||e===je||e===De?1:t===je||t===De?-1:e===nt?1:t===nt?-1:e.length===t.length?e<t?-1:1:t.length-e.length}var se,ie,k,le,Nn=(le=class{constructor(){w(this,se);w(this,ie);w(this,k,Object.create(null))}insert(t,r,n,a,s){if(t.length===0){if(u(this,se)!==void 0)throw he;if(s)return;g(this,se,r);return}const[i,...o]=t,c=i==="*"?o.length===0?["","",je]:["","",nt]:i==="/*"?["","",De]:i.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);let l;if(c){const d=c[1];let f=c[2]||nt;if(d&&c[2]&&(f===".*"||(f=f.replace(/^\((?!\?:)(?=[^)]+\)$)/,"(?:"),/\((?!\?:)/.test(f))))throw he;if(l=u(this,k)[f],!l){if(Object.keys(u(this,k)).some(p=>p!==je&&p!==De))throw he;if(s)return;l=u(this,k)[f]=new le,d!==""&&g(l,ie,a.varIndex++)}!s&&d!==""&&n.push([d,u(l,ie)])}else if(l=u(this,k)[i],!l){if(Object.keys(u(this,k)).some(d=>d.length>1&&d!==je&&d!==De))throw he;if(s)return;l=u(this,k)[i]=new le}l.insert(o,r,n,a,s)}buildRegExpStr(){const r=Object.keys(u(this,k)).sort(xn).map(n=>{const a=u(this,k)[n];return(typeof u(a,ie)=="number"?`(${n})@${u(a,ie)}`:Tn.has(n)?`\\${n}`:n)+a.buildRegExpStr()});return typeof u(this,se)=="number"&&r.unshift(`#${u(this,se)}`),r.length===0?"":r.length===1?r[0]:"(?:"+r.join("|")+")"}},se=new WeakMap,ie=new WeakMap,k=new WeakMap,le),at,ke,Xt,jn=(Xt=class{constructor(){w(this,at,{varIndex:0});w(this,ke,new Nn)}insert(e,t,r){const n=[],a=[];for(let i=0;;){let o=!1;if(e=e.replace(/\{[^}]+\}/g,c=>{const l=`@\\${i}`;return a[i]=[l,c],i++,o=!0,l}),!o)break}const s=e.match(/(?::[^\/]+)|(?:\/\*$)|./g)||[];for(let i=a.length-1;i>=0;i--){const[o]=a[i];for(let c=s.length-1;c>=0;c--)if(s[c].indexOf(o)!==-1){s[c]=s[c].replace(o,a[i][1]);break}}return u(this,ke).insert(s,t,n,u(this,at),r),n}buildRegExp(){let e=u(this,ke).buildRegExpStr();if(e==="")return[/^$/,[],[]];let t=0;const r=[],n=[];return e=e.replace(/#(\d+)|@(\d+)|\.\*\$/g,(a,s,i)=>s!==void 0?(r[++t]=Number(s),"$()"):(i!==void 0&&(n[Number(i)]=++t),"")),[new RegExp(`^${e}`),r,n]}},at=new WeakMap,ke=new WeakMap,Xt),Dn=[/^$/,[],Object.create(null)],Ze=Object.create(null);function Sr(e){return Ze[e]??(Ze[e]=new RegExp(e==="*"?"":`^${e.replace(/\/\*$|([.\\+*[^\]$()])/g,(t,r)=>r?`\\${r}`:"(?:|/.*)")}$`))}function An(){Ze=Object.create(null)}function Cn(e){var l;const t=new jn,r=[];if(e.length===0)return Dn;const n=e.map(d=>[!/\*|\/:/.test(d[0]),...d]).sort(([d,f],[p,h])=>d?1:p?-1:f.length-h.length),a=Object.create(null);for(let d=0,f=-1,p=n.length;d<p;d++){const[h,y,v]=n[d];h?a[y]=[v.map(([E])=>[E,Object.create(null)]),Rr]:f++;let m;try{m=t.insert(y,f,h)}catch(E){throw E===he?new wr(y):E}h||(r[f]=v.map(([E,b])=>{const T=Object.create(null);for(b-=1;b>=0;b--){const[O,x]=m[b];T[O]=x}return[E,T]}))}const[s,i,o]=t.buildRegExp();for(let d=0,f=r.length;d<f;d++)for(let p=0,h=r[d].length;p<h;p++){const y=(l=r[d][p])==null?void 0:l[1];if(!y)continue;const v=Object.keys(y);for(let m=0,E=v.length;m<E;m++)y[v[m]]=o[y[v[m]]]}const c=[];for(const d in i)c[d]=r[i[d]];return[s,c,a]}function ue(e,t){if(e){for(const r of Object.keys(e).sort((n,a)=>a.length-n.length))if(Sr(r).test(t))return[...e[r]]}}var X,Z,st,Or,Zt,In=(Zt=class{constructor(){w(this,st);_(this,"name","RegExpRouter");w(this,X);w(this,Z);_(this,"match",On);g(this,X,{[j]:Object.create(null)}),g(this,Z,{[j]:Object.create(null)})}add(e,t,r){var o;const n=u(this,X),a=u(this,Z);if(!n||!a)throw new Error(Er);n[e]||[n,a].forEach(c=>{c[e]=Object.create(null),Object.keys(c[j]).forEach(l=>{c[e][l]=[...c[j][l]]})}),t==="/*"&&(t="*");const s=(t.match(/\/:/g)||[]).length;if(/\*$/.test(t)){const c=Sr(t);e===j?Object.keys(n).forEach(l=>{var d;(d=n[l])[t]||(d[t]=ue(n[l],t)||ue(n[j],t)||[])}):(o=n[e])[t]||(o[t]=ue(n[e],t)||ue(n[j],t)||[]),Object.keys(n).forEach(l=>{(e===j||e===l)&&Object.keys(n[l]).forEach(d=>{c.test(d)&&n[l][d].push([r,s])})}),Object.keys(a).forEach(l=>{(e===j||e===l)&&Object.keys(a[l]).forEach(d=>c.test(d)&&a[l][d].push([r,s]))});return}const i=hr(t)||[t];for(let c=0,l=i.length;c<l;c++){const d=i[c];Object.keys(a).forEach(f=>{var p;(e===j||e===f)&&((p=a[f])[d]||(p[d]=[...ue(n[f],d)||ue(n[j],d)||[]]),a[f][d].push([r,s-l+c+1]))})}}buildAllMatchers(){const e=Object.create(null);return Object.keys(u(this,Z)).concat(Object.keys(u(this,X))).forEach(t=>{e[t]||(e[t]=S(this,st,Or).call(this,t))}),g(this,X,g(this,Z,void 0)),An(),e}},X=new WeakMap,Z=new WeakMap,st=new WeakSet,Or=function(e){const t=[];let r=e===j;return[u(this,X),u(this,Z)].forEach(n=>{const a=n[e]?Object.keys(n[e]).map(s=>[s,n[e][s]]):[];a.length!==0?(r||(r=!0),t.push(...a)):e!==j&&t.push(...Object.keys(n[j]).map(s=>[s,n[j][s]]))}),r?Cn(t):null},Zt),Q,Y,Qt,Fn=(Qt=class{constructor(e){_(this,"name","SmartRouter");w(this,Q,[]);w(this,Y,[]);g(this,Q,e.routers)}add(e,t,r){if(!u(this,Y))throw new Error(Er);u(this,Y).push([e,t,r])}match(e,t){if(!u(this,Y))throw new Error("Fatal error");const r=u(this,Q),n=u(this,Y),a=r.length;let s=0,i;for(;s<a;s++){const o=r[s];try{for(let c=0,l=n.length;c<l;c++)o.add(...n[c]);i=o.match(e,t)}catch(c){if(c instanceof wr)continue;throw c}this.match=o.match.bind(o),g(this,Q,[o]),g(this,Y,void 0);break}if(s===a)throw new Error("Fatal error");return this.name=`SmartRouter + ${this.activeRouter.name}`,i}get activeRouter(){if(u(this,Y)||u(this,Q).length!==1)throw new Error("No active router has been determined yet.");return u(this,Q)[0]}},Q=new WeakMap,Y=new WeakMap,Qt),xe=Object.create(null),ee,C,oe,Ee,A,z,ne,we,qn=(we=class{constructor(t,r,n){w(this,z);w(this,ee);w(this,C);w(this,oe);w(this,Ee,0);w(this,A,xe);if(g(this,C,n||Object.create(null)),g(this,ee,[]),t&&r){const a=Object.create(null);a[t]={handler:r,possibleKeys:[],score:0},g(this,ee,[a])}g(this,oe,[])}insert(t,r,n){g(this,Ee,++Dt(this,Ee)._);let a=this;const s=un(r),i=[];for(let o=0,c=s.length;o<c;o++){const l=s[o],d=s[o+1],f=pn(l,d),p=Array.isArray(f)?f[0]:l;if(p in u(a,C)){a=u(a,C)[p],f&&i.push(f[1]);continue}u(a,C)[p]=new we,f&&(u(a,oe).push(f),i.push(f[1])),a=u(a,C)[p]}return u(a,ee).push({[t]:{handler:n,possibleKeys:i.filter((o,c,l)=>l.indexOf(o)===c),score:u(this,Ee)}}),a}search(t,r){var c;const n=[];g(this,A,xe);let s=[this];const i=fr(r),o=[];for(let l=0,d=i.length;l<d;l++){const f=i[l],p=l===d-1,h=[];for(let y=0,v=s.length;y<v;y++){const m=s[y],E=u(m,C)[f];E&&(g(E,A,u(m,A)),p?(u(E,C)["*"]&&n.push(...S(this,z,ne).call(this,u(E,C)["*"],t,u(m,A))),n.push(...S(this,z,ne).call(this,E,t,u(m,A)))):h.push(E));for(let b=0,T=u(m,oe).length;b<T;b++){const O=u(m,oe)[b],x=u(m,A)===xe?{}:{...u(m,A)};if(O==="*"){const V=u(m,C)["*"];V&&(n.push(...S(this,z,ne).call(this,V,t,u(m,A))),g(V,A,x),h.push(V));continue}const[Oe,We,Te]=O;if(!f&&!(Te instanceof RegExp))continue;const B=u(m,C)[Oe],Mr=i.slice(l).join("/");if(Te instanceof RegExp){const V=Te.exec(Mr);if(V){if(x[We]=V[0],n.push(...S(this,z,ne).call(this,B,t,u(m,A),x)),Object.keys(u(B,C)).length){g(B,A,x);const it=((c=V[0].match(/\//))==null?void 0:c.length)??0;(o[it]||(o[it]=[])).push(B)}continue}}(Te===!0||Te.test(f))&&(x[We]=f,p?(n.push(...S(this,z,ne).call(this,B,t,x,u(m,A))),u(B,C)["*"]&&n.push(...S(this,z,ne).call(this,u(B,C)["*"],t,x,u(m,A)))):(g(B,A,x),h.push(B)))}}s=h.concat(o.shift()??[])}return n.length>1&&n.sort((l,d)=>l.score-d.score),[n.map(({handler:l,params:d})=>[l,d])]}},ee=new WeakMap,C=new WeakMap,oe=new WeakMap,Ee=new WeakMap,A=new WeakMap,z=new WeakSet,ne=function(t,r,n,a){const s=[];for(let i=0,o=u(t,ee).length;i<o;i++){const c=u(t,ee)[i],l=c[r]||c[j],d={};if(l!==void 0&&(l.params=Object.create(null),s.push(l),n!==xe||a&&a!==xe))for(let f=0,p=l.possibleKeys.length;f<p;f++){const h=l.possibleKeys[f],y=d[l.score];l.params[h]=a!=null&&a[h]&&!y?a[h]:n[h]??(a==null?void 0:a[h]),d[l.score]=!0}}return s},we),ce,er,Pn=(er=class{constructor(){_(this,"name","TrieRouter");w(this,ce);g(this,ce,new qn)}add(e,t,r){const n=hr(t);if(n){for(let a=0,s=n.length;a<s;a++)u(this,ce).insert(e,n[a],r);return}u(this,ce).insert(e,t,r)}match(e,t){return u(this,ce).search(e,t)}},ce=new WeakMap,er),Tr=class extends Sn{constructor(e={}){super(e),this.router=e.router??new Fn({routers:[new In,new Pn]})}},Ln=e=>{const r={...{origin:"*",allowMethods:["GET","HEAD","PUT","POST","DELETE","PATCH"],allowHeaders:[],exposeHeaders:[]},...e},n=(s=>typeof s=="string"?s==="*"?()=>s:i=>s===i?i:null:typeof s=="function"?s:i=>s.includes(i)?i:null)(r.origin),a=(s=>typeof s=="function"?s:Array.isArray(s)?()=>s:()=>[])(r.allowMethods);return async function(i,o){var d;function c(f,p){i.res.headers.set(f,p)}const l=await n(i.req.header("origin")||"",i);if(l&&c("Access-Control-Allow-Origin",l),r.credentials&&c("Access-Control-Allow-Credentials","true"),(d=r.exposeHeaders)!=null&&d.length&&c("Access-Control-Expose-Headers",r.exposeHeaders.join(",")),i.req.method==="OPTIONS"){r.origin!=="*"&&c("Vary","Origin"),r.maxAge!=null&&c("Access-Control-Max-Age",r.maxAge.toString());const f=await a(i.req.header("origin")||"",i);f.length&&c("Access-Control-Allow-Methods",f.join(","));let p=r.allowHeaders;if(!(p!=null&&p.length)){const h=i.req.header("Access-Control-Request-Headers");h&&(p=h.split(/\s*,\s*/))}return p!=null&&p.length&&(c("Access-Control-Allow-Headers",p.join(",")),i.res.headers.append("Vary","Access-Control-Request-Headers")),i.res.headers.delete("Content-Length"),i.res.headers.delete("Content-Type"),new Response(null,{headers:i.res.headers,status:204,statusText:"No Content"})}await o(),r.origin!=="*"&&i.header("Vary","Origin",{append:!0})}},Mn=/^\s*(?:text\/(?!event-stream(?:[;\s]|$))[^;\s]+|application\/(?:javascript|json|xml|xml-dtd|ecmascript|dart|postscript|rtf|tar|toml|vnd\.dart|vnd\.ms-fontobject|vnd\.ms-opentype|wasm|x-httpd-php|x-javascript|x-ns-proxy-autoconfig|x-sh|x-tar|x-virtualbox-hdd|x-virtualbox-ova|x-virtualbox-ovf|x-virtualbox-vbox|x-virtualbox-vdi|x-virtualbox-vhd|x-virtualbox-vmdk|x-www-form-urlencoded)|font\/(?:otf|ttf)|image\/(?:bmp|vnd\.adobe\.photoshop|vnd\.microsoft\.icon|vnd\.ms-dds|x-icon|x-ms-bmp)|message\/rfc822|model\/gltf-binary|x-shader\/x-fragment|x-shader\/x-vertex|[^;\s]+?\+(?:json|text|xml|yaml))(?:[;\s]|$)/i,kt=(e,t=Hn)=>{const r=/\.([a-zA-Z0-9]+?)$/,n=e.match(r);if(!n)return;let a=t[n[1]];return a&&a.startsWith("text")&&(a+="; charset=utf-8"),a},kn={aac:"audio/aac",avi:"video/x-msvideo",avif:"image/avif",av1:"video/av1",bin:"application/octet-stream",bmp:"image/bmp",css:"text/css",csv:"text/csv",eot:"application/vnd.ms-fontobject",epub:"application/epub+zip",gif:"image/gif",gz:"application/gzip",htm:"text/html",html:"text/html",ico:"image/x-icon",ics:"text/calendar",jpeg:"image/jpeg",jpg:"image/jpeg",js:"text/javascript",json:"application/json",jsonld:"application/ld+json",map:"application/json",mid:"audio/x-midi",midi:"audio/x-midi",mjs:"text/javascript",mp3:"audio/mpeg",mp4:"video/mp4",mpeg:"video/mpeg",oga:"audio/ogg",ogv:"video/ogg",ogx:"application/ogg",opus:"audio/opus",otf:"font/otf",pdf:"application/pdf",png:"image/png",rtf:"application/rtf",svg:"image/svg+xml",tif:"image/tiff",tiff:"image/tiff",ts:"video/mp2t",ttf:"font/ttf",txt:"text/plain",wasm:"application/wasm",webm:"video/webm",weba:"audio/webm",webmanifest:"application/manifest+json",webp:"image/webp",woff:"font/woff",woff2:"font/woff2",xhtml:"application/xhtml+xml",xml:"application/xml",zip:"application/zip","3gp":"video/3gpp","3g2":"video/3gpp2",gltf:"model/gltf+json",glb:"model/gltf-binary"},Hn=kn,Bn=(...e)=>{let t=e.filter(a=>a!=="").join("/");t=t.replace(new RegExp("(?<=\\/)\\/+","g"),"");const r=t.split("/"),n=[];for(const a of r)a===".."&&n.length>0&&n.at(-1)!==".."?n.pop():a!=="."&&n.push(a);return n.join("/")||"."},xr={br:".br",zstd:".zst",gzip:".gz"},$n=Object.keys(xr),Un="index.html",Wn=e=>{const t=e.root??"./",r=e.path,n=e.join??Bn;return async(a,s)=>{var d,f,p,h;if(a.finalized)return s();let i;if(e.path)i=e.path;else try{if(i=decodeURIComponent(a.req.path),/(?:^|[\/\\])\.\.(?:$|[\/\\])/.test(i))throw new Error}catch{return await((d=e.onNotFound)==null?void 0:d.call(e,a.req.path,a)),s()}let o=n(t,!r&&e.rewriteRequestPath?e.rewriteRequestPath(i):i);e.isDir&&await e.isDir(o)&&(o=n(o,Un));const c=e.getContent;let l=await c(o,a);if(l instanceof Response)return a.newResponse(l.body,l);if(l){const y=e.mimes&&kt(o,e.mimes)||kt(o);if(a.header("Content-Type",y||"application/octet-stream"),e.precompressed&&(!y||Mn.test(y))){const v=new Set((f=a.req.header("Accept-Encoding"))==null?void 0:f.split(",").map(m=>m.trim()));for(const m of $n){if(!v.has(m))continue;const E=await c(o+xr[m],a);if(E){l=E,a.header("Content-Encoding",m),a.header("Vary","Accept-Encoding",{append:!0});break}}}return await((p=e.onFound)==null?void 0:p.call(e,o,a)),a.body(l)}await((h=e.onNotFound)==null?void 0:h.call(e,o,a)),await s()}},Yn=async(e,t)=>{let r;t&&t.manifest?typeof t.manifest=="string"?r=JSON.parse(t.manifest):r=t.manifest:typeof __STATIC_CONTENT_MANIFEST=="string"?r=JSON.parse(__STATIC_CONTENT_MANIFEST):r=__STATIC_CONTENT_MANIFEST;let n;t&&t.namespace?n=t.namespace:n=__STATIC_CONTENT;const a=r[e];if(!a)return null;const s=await n.get(a,{type:"stream"});return s||null},zn=e=>async function(r,n){return Wn({...e,getContent:async s=>Yn(s,{manifest:e.manifest,namespace:e.namespace?e.namespace:r.env?r.env.__STATIC_CONTENT:void 0})})(r,n)},Jn=e=>zn(e),Ce="_hp",Vn={Change:"Input",DoubleClick:"DblClick"},Kn={svg:"2000/svg",math:"1998/Math/MathML"},Ie=[],Et=new WeakMap,Re=void 0,Gn=()=>Re,$=e=>"t"in e,ft={onClick:["click",!1]},Ht=e=>{if(!e.startsWith("on"))return;if(ft[e])return ft[e];const t=e.match(/^on([A-Z][a-zA-Z]+?(?:PointerCapture)?)(Capture)?$/);if(t){const[,r,n]=t;return ft[e]=[(Vn[r]||r).toLowerCase(),!!n]}},Bt=(e,t)=>Re&&e instanceof SVGElement&&/[A-Z]/.test(t)&&(t in e.style||t.match(/^(?:o|pai|str|u|ve)/))?t.replace(/([A-Z])/g,"-$1").toLowerCase():t,Xn=(e,t,r)=>{var n;t||(t={});for(let a in t){const s=t[a];if(a!=="children"&&(!r||r[a]!==s)){a=rt(a);const i=Ht(a);if(i){if((r==null?void 0:r[a])!==s&&(r&&e.removeEventListener(i[0],r[a],i[1]),s!=null)){if(typeof s!="function")throw new Error(`Event handler for "${a}" is not a function`);e.addEventListener(i[0],s,i[1])}}else if(a==="dangerouslySetInnerHTML"&&s)e.innerHTML=s.__html;else if(a==="ref"){let o;typeof s=="function"?o=s(e)||(()=>s(null)):s&&"current"in s&&(s.current=e,o=()=>s.current=null),Et.set(e,o)}else if(a==="style"){const o=e.style;typeof s=="string"?o.cssText=s:(o.cssText="",s!=null&&ur(s,o.setProperty.bind(o)))}else{if(a==="value"){const c=e.nodeName;if(c==="INPUT"||c==="TEXTAREA"||c==="SELECT"){if(e.value=s==null||s===!1?null:s,c==="TEXTAREA"){e.textContent=s;continue}else if(c==="SELECT"){e.selectedIndex===-1&&(e.selectedIndex=0);continue}}}else(a==="checked"&&e.nodeName==="INPUT"||a==="selected"&&e.nodeName==="OPTION")&&(e[a]=s);const o=Bt(e,a);s==null||s===!1?e.removeAttribute(o):s===!0?e.setAttribute(o,""):typeof s=="string"||typeof s=="number"?e.setAttribute(o,s):e.setAttribute(o,s.toString())}}}if(r)for(let a in r){const s=r[a];if(a!=="children"&&!(a in t)){a=rt(a);const i=Ht(a);i?e.removeEventListener(i[0],s,i[1]):a==="ref"?(n=Et.get(e))==null||n():e.removeAttribute(Bt(e,a))}}},Zn=(e,t)=>{t[N][0]=0,Ie.push([e,t]);const r=t.tag[bt]||t.tag,n=r.defaultProps?{...r.defaultProps,...t.props}:t.props;try{return[r.call(null,n)]}finally{Ie.pop()}},Nr=(e,t,r,n,a)=>{var s,i;(s=e.vR)!=null&&s.length&&(n.push(...e.vR),delete e.vR),typeof e.tag=="function"&&((i=e[N][1][Cr])==null||i.forEach(o=>a.push(o))),e.vC.forEach(o=>{var c;if($(o))r.push(o);else if(typeof o.tag=="function"||o.tag===""){o.c=t;const l=r.length;if(Nr(o,t,r,n,a),o.s){for(let d=l;d<r.length;d++)r[d].s=!0;o.s=!1}}else r.push(o),(c=o.vR)!=null&&c.length&&(n.push(...o.vR),delete o.vR)})},Qn=e=>{var t;for(;e&&(e.tag===Ce||!e.e);)e=e.tag===Ce||!((t=e.vC)!=null&&t[0])?e.nN:e.vC[0];return e==null?void 0:e.e},jr=e=>{var t,r,n,a,s,i;$(e)||((r=(t=e[N])==null?void 0:t[1][Cr])==null||r.forEach(o=>{var c;return(c=o[2])==null?void 0:c.call(o)}),(n=Et.get(e.e))==null||n(),e.p===2&&((a=e.vC)==null||a.forEach(o=>o.p=2)),(s=e.vC)==null||s.forEach(jr)),e.p||((i=e.e)==null||i.remove(),delete e.e),typeof e.tag=="function"&&(Ne.delete(e),Qe.delete(e),delete e[N][3],e.a=!0)},Dr=(e,t,r)=>{e.c=t,Ar(e,t,r)},$t=(e,t)=>{if(t){for(let r=0,n=e.length;r<n;r++)if(e[r]===t)return r}},Ut=Symbol(),Ar=(e,t,r)=>{var l;const n=[],a=[],s=[];Nr(e,t,n,a,s),a.forEach(jr);const i=r?void 0:t.childNodes;let o,c=null;if(r)o=-1;else if(!i.length)o=0;else{const d=$t(i,Qn(e.nN));d!==void 0?(c=i[d],o=d):o=$t(i,(l=n.find(f=>f.tag!==Ce&&f.e))==null?void 0:l.e)??-1,o===-1&&(r=!0)}for(let d=0,f=n.length;d<f;d++,o++){const p=n[d];let h;if(p.s&&p.e)h=p.e,p.s=!1;else{const y=r||!p.e;$(p)?(p.e&&p.d&&(p.e.textContent=p.t),p.d=!1,h=p.e||(p.e=document.createTextNode(p.t))):(h=p.e||(p.e=p.n?document.createElementNS(p.n,p.tag):document.createElement(p.tag)),Xn(h,p.props,p.pP),Ar(p,h,y))}p.tag===Ce?o--:r?h.parentNode||t.appendChild(h):i[o]!==h&&i[o-1]!==h&&(i[o+1]===h?t.appendChild(i[o]):t.insertBefore(h,c||i[o]||null))}if(e.pP&&(e.pP=void 0),s.length){const d=[],f=[];s.forEach(([,p,,h,y])=>{p&&d.push(p),h&&f.push(h),y==null||y()}),d.forEach(p=>p()),f.length&&requestAnimationFrame(()=>{f.forEach(p=>p())})}},ea=(e,t)=>!!(e&&e.length===t.length&&e.every((r,n)=>r[1]===t[n][1])),Qe=new WeakMap,wt=(e,t,r)=>{var s,i,o,c,l,d;const n=!r&&t.pC;r&&(t.pC||(t.pC=t.vC));let a;try{r||(r=typeof t.tag=="function"?Zn(e,t):He(t.props.children)),((s=r[0])==null?void 0:s.tag)===""&&r[0][_t]&&(a=r[0][_t],e[5].push([e,a,t]));const f=n?[...t.pC]:t.vC?[...t.vC]:void 0,p=[];let h;for(let y=0;y<r.length;y++){Array.isArray(r[y])&&r.splice(y,1,...r[y].flat());let v=ta(r[y]);if(v){typeof v.tag=="function"&&!v.tag[sr]&&(be.length>0&&(v[N][2]=be.map(E=>[E,E.values.at(-1)])),(i=e[5])!=null&&i.length&&(v[N][3]=e[5].at(-1)));let m;if(f&&f.length){const E=f.findIndex($(v)?b=>$(b):v.key!==void 0?b=>b.key===v.key&&b.tag===v.tag:b=>b.tag===v.tag);E!==-1&&(m=f[E],f.splice(E,1))}if(m)if($(v))m.t!==v.t&&(m.t=v.t,m.d=!0),v=m;else{const E=m.pP=m.props;if(m.props=v.props,m.f||(m.f=v.f||t.f),typeof v.tag=="function"){const b=m[N][2];m[N][2]=v[N][2]||[],m[N][3]=v[N][3],!m.f&&((m.o||m)===v.o||(c=(o=m.tag)[Ur])!=null&&c.call(o,E,m.props))&&ea(b,m[N][2])&&(m.s=!0)}v=m}else if(!$(v)&&Re){const E=Se(Re);E&&(v.n=E)}if(!$(v)&&!v.s&&(wt(e,v),delete v.f),p.push(v),h&&!h.s&&!v.s)for(let E=h;E&&!$(E);E=(l=E.vC)==null?void 0:l.at(-1))E.nN=v;h=v}}t.vR=n?[...t.vC,...f||[]]:f||[],t.vC=p,n&&delete t.pC}catch(f){if(t.f=!0,f===Ut){if(a)return;throw f}const[p,h,y]=((d=t[N])==null?void 0:d[3])||[];if(h){const v=()=>et([0,!1,e[2]],y),m=Qe.get(y)||[];m.push(v),Qe.set(y,m);const E=h(f,()=>{const b=Qe.get(y);if(b){const T=b.indexOf(v);if(T!==-1)return b.splice(T,1),v()}});if(E){if(e[0]===1)e[1]=!0;else if(wt(e,y,[E]),(h.length===1||e!==p)&&y.c){Dr(y,y.c,!1);return}throw Ut}}throw f}finally{a&&e[5].pop()}},ta=e=>{if(!(e==null||typeof e=="boolean")){if(typeof e=="string"||typeof e=="number")return{t:e.toString(),d:!0};if("vR"in e&&(e={tag:e.tag,props:e.props,key:e.key,f:e.f,type:e.tag,ref:e.props.ref,o:e.o||e}),typeof e.tag=="function")e[N]=[0,[]];else{const t=Kn[e.tag];t&&(Re||(Re=or("")),e.props.children=[{tag:Re,props:{value:e.n=`http://www.w3.org/${t}`,children:e.props.children}}])}return e}},Wt=(e,t)=>{var r,n;(r=t[N][2])==null||r.forEach(([a,s])=>{a.values.push(s)});try{wt(e,t,void 0)}catch{return}if(t.a){delete t.a;return}(n=t[N][2])==null||n.forEach(([a])=>{a.values.pop()}),(e[0]!==1||!e[1])&&Dr(t,t.c,!1)},Ne=new WeakMap,Yt=[],et=async(e,t)=>{e[5]||(e[5]=[]);const r=Ne.get(t);r&&r[0](void 0);let n;const a=new Promise(s=>n=s);if(Ne.set(t,[n,()=>{e[2]?e[2](e,t,s=>{Wt(s,t)}).then(()=>n(t)):(Wt(e,t),n(t))}]),Yt.length)Yt.at(-1).add(t);else{await Promise.resolve();const s=Ne.get(t);s&&(Ne.delete(t),s[1]())}return a},ra=(e,t,r)=>({tag:Ce,props:{children:e},key:r,e:t,p:1}),pt=0,Cr=1,ht=2,mt=3,yt=new WeakMap,Ir=(e,t)=>!e||!t||e.length!==t.length||t.some((r,n)=>r!==e[n]),na=void 0,zt=[],aa=e=>{var i;const t=()=>typeof e=="function"?e():e,r=Ie.at(-1);if(!r)return[t(),()=>{}];const[,n]=r,a=(i=n[N][1])[pt]||(i[pt]=[]),s=n[N][0]++;return a[s]||(a[s]=[t(),o=>{const c=na,l=a[s];if(typeof o=="function"&&(o=o(l[0])),!Object.is(o,l[0]))if(l[0]=o,zt.length){const[d,f]=zt.at(-1);Promise.all([d===3?n:et([d,!1,c],n),f]).then(([p])=>{if(!p||!(d===2||d===3))return;const h=p.vC;requestAnimationFrame(()=>{setTimeout(()=>{h===p.vC&&et([d===3?1:0,!1,c],p)})})})}else et([0,!1,c],n)}])},xt=(e,t)=>{var o;const r=Ie.at(-1);if(!r)return e;const[,n]=r,a=(o=n[N][1])[ht]||(o[ht]=[]),s=n[N][0]++,i=a[s];return Ir(i==null?void 0:i[1],t)?a[s]=[e,t]:e=a[s][0],e},sa=e=>{const t=yt.get(e);if(t){if(t.length===2)throw t[1];return t[0]}throw e.then(r=>yt.set(e,[r]),r=>yt.set(e,[void 0,r])),e},ia=(e,t)=>{var o;const r=Ie.at(-1);if(!r)return e();const[,n]=r,a=(o=n[N][1])[mt]||(o[mt]=[]),s=n[N][0]++,i=a[s];return Ir(i==null?void 0:i[1],t)&&(a[s]=[e(),t]),a[s][0]},oa=or({pending:!1,data:null,method:null,action:null}),Jt=new Set,ca=e=>{Jt.add(e),e.finally(()=>Jt.delete(e))},Nt=(e,t)=>ia(()=>r=>{let n;e&&(typeof e=="function"?n=e(r)||(()=>{e(null)}):e&&"current"in e&&(e.current=r,n=()=>{e.current=null}));const a=t(r);return()=>{a==null||a(),n==null||n()}},[e]),de=Object.create(null),ze=Object.create(null),Ue=(e,t,r,n,a)=>{if(t!=null&&t.itemProp)return{tag:e,props:t,type:e,ref:t.ref};const s=document.head;let{onLoad:i,onError:o,precedence:c,blocking:l,...d}=t,f=null,p=!1;const h=Je[e];let y;if(h.length>0){const b=s.querySelectorAll(e);e:for(const T of b)for(const O of Je[e])if(T.getAttribute(O)===t[O]){f=T;break e}if(!f){const T=h.reduce((O,x)=>t[x]===void 0?O:`${O}-${x}-${t[x]}`,e);p=!ze[T],f=ze[T]||(ze[T]=(()=>{const O=document.createElement(e);for(const x of h)t[x]!==void 0&&O.setAttribute(x,t[x]),t.rel&&O.setAttribute("rel",t.rel);return O})())}}else y=s.querySelectorAll(e);c=n?c??"":void 0,n&&(d[Ve]=c);const v=xt(b=>{if(h.length>0){let T=!1;for(const O of s.querySelectorAll(e)){if(T&&O.getAttribute(Ve)!==c){s.insertBefore(b,O);return}O.getAttribute(Ve)===c&&(T=!0)}s.appendChild(b)}else if(y){let T=!1;for(const O of y)if(O===b){T=!0;break}T||s.insertBefore(b,s.contains(y[0])?y[0]:s.querySelector(e)),y=void 0}},[c]),m=Nt(t.ref,b=>{var x;const T=h[0];if(r===2&&(b.innerHTML=""),(p||y)&&v(b),!o&&!i)return;let O=de[x=b.getAttribute(T)]||(de[x]=new Promise((Oe,We)=>{b.addEventListener("load",Oe),b.addEventListener("error",We)}));i&&(O=O.then(i)),o&&(O=O.catch(o)),O.catch(()=>{})});if(a&&l==="render"){const b=Je[e][0];if(t[b]){const T=t[b],O=de[T]||(de[T]=new Promise((x,Oe)=>{v(f),f.addEventListener("load",x),f.addEventListener("error",Oe)}));sa(O)}}const E={tag:e,type:e,props:{...d,ref:m},ref:m};return E.p=r,f&&(E.e=f),ra(E,s)},la=e=>{const t=Gn(),r=t&&Se(t);return r!=null&&r.endsWith("svg")?{tag:"title",props:e,type:"title",ref:e.ref}:Ue("title",e,void 0,!1,!1)},ua=e=>!e||["src","async"].some(t=>!e[t])?{tag:"script",props:e,type:"script",ref:e.ref}:Ue("script",e,1,!1,!0),da=e=>!e||!["href","precedence"].every(t=>t in e)?{tag:"style",props:e,type:"style",ref:e.ref}:(e["data-href"]=e.href,delete e.href,Ue("style",e,2,!0,!0)),fa=e=>!e||["onLoad","onError"].some(t=>t in e)||e.rel==="stylesheet"&&(!("precedence"in e)||"disabled"in e)?{tag:"link",props:e,type:"link",ref:e.ref}:Ue("link",e,1,"precedence"in e,!0),pa=e=>Ue("meta",e,void 0,!1,!1),Fr=Symbol(),ha=e=>{const{action:t,...r}=e;typeof t!="function"&&(r.action=t);const[n,a]=aa([null,!1]),s=xt(async l=>{const d=l.isTrusted?t:l.detail[Fr];if(typeof d!="function")return;l.preventDefault();const f=new FormData(l.target);a([f,!0]);const p=d(f);p instanceof Promise&&(ca(p),await p),a([null,!0])},[]),i=Nt(e.ref,l=>(l.addEventListener("submit",s),()=>{l.removeEventListener("submit",s)})),[o,c]=n;return n[1]=!1,{tag:oa,props:{value:{pending:o!==null,data:o,method:o?"post":null,action:o?t:null},children:{tag:"form",props:{...r,ref:i},type:"form",ref:i}},f:c}},qr=(e,{formAction:t,...r})=>{if(typeof t=="function"){const n=xt(a=>{a.preventDefault(),a.currentTarget.form.dispatchEvent(new CustomEvent("submit",{detail:{[Fr]:t}}))},[]);r.ref=Nt(r.ref,a=>(a.addEventListener("click",n),()=>{a.removeEventListener("click",n)}))}return{tag:e,props:r,type:e,ref:r.ref}},ma=e=>qr("input",e),ya=e=>qr("button",e);Object.assign(vt,{title:la,script:ua,style:da,link:fa,meta:pa,form:ha,input:ma,button:ya});Rt(null);new TextEncoder;var _a=Rt(null),va=(e,t,r,n)=>(a,s)=>{const i="<!DOCTYPE html>",o=r?Ft(l=>r(l,e),{Layout:t,...s},a):a,c=$r`${P(i)}${Ft(_a.Provider,{value:e},o)}`;return e.html(c)},ga=(e,t)=>function(n,a){const s=n.getLayout()??rn;return e&&n.setLayout(i=>e({...i,Layout:s},n)),n.setRenderer(va(n,s,e)),a()};const Ea=ga(({children:e})=>F("html",{lang:"en",children:[F("head",{children:[F("meta",{charset:"UTF-8"}),F("meta",{name:"viewport",content:"width=device-width, initial-scale=1.0"}),F("title",{children:"TuloTech Africa - HR Management System"}),F("script",{src:"https://cdn.tailwindcss.com"}),F("link",{href:"https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css",rel:"stylesheet"}),F("style",{children:`
          @keyframes fade-in {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
          }
          .animate-fade-in {
            animation: fade-in 0.3s ease-out;
          }
          .nav-item {
            transition: all 0.2s ease;
          }
          .nav-item:hover {
            transform: translateX(5px);
          }
          @media print {
            .no-print { display: none !important; }
            body { background: white !important; }
          }
        `})]}),F("body",{class:"bg-gray-50",children:[e,F("script",{src:"/static/app.js"}),F("script",{src:"/static/app-views.js"}),F("script",{src:"/static/app-payslips.js"}),F("script",{src:"/static/app-calendar.js"})]})]}));function wa(e){const t=[{min:0,max:5e4,rate:0,fixed:0},{min:50001,max:1e5,rate:.18,fixed:0},{min:100001,max:3e5,rate:.25,fixed:9e3},{min:300001,max:5e5,rate:.28,fixed:59e3},{min:500001,max:8e5,rate:.3,fixed:115e3},{min:800001,max:1/0,rate:.37,fixed:205e3}];for(const r of t)if(e>=r.min&&e<=r.max){const n=e-r.min+1;return r.fixed+n*r.rate}return 0}function ba(e){const n=Math.min(e,81e3);return{employee:n*.009,employer:n*.009}}function Ra(e){const t=[{min:0,max:237100,rate:.18,fixed:0},{min:237101,max:370500,rate:.26,fixed:42678},{min:370501,max:512800,rate:.31,fixed:77362},{min:512801,max:673e3,rate:.36,fixed:121475},{min:673001,max:857900,rate:.39,fixed:179147},{min:857901,max:1/0,rate:.41,fixed:251258}];for(const r of t)if(e>=r.min&&e<=r.max){const n=e-r.min+1;return r.fixed+n*r.rate}return 0}function Sa(e){const n=Math.min(e,17712);return{employee:n*.01,employer:n*.01}}function Oa(e){return e*.01}function Pr(e,t,r=0){const n=e*12+r;if(t==="Namibia"){const a=wa(n),s=a/12,i=ba(e);return{monthlyPAYE:s,annualPAYE:a,ssc_employee:i.employee,ssc_employer:i.employer,uif_employee:0,uif_employer:0,sdl:0,totalEmployeeDeductions:s+i.employee,totalEmployerContributions:i.employer}}else if(t==="South Africa"){const a=Ra(n),s=a/12,i=Sa(e),o=Oa(e);return{monthlyPAYE:s,annualPAYE:a,ssc_employee:0,ssc_employer:0,uif_employee:i.employee,uif_employer:i.employer,sdl:o,totalEmployeeDeductions:s+i.employee,totalEmployerContributions:i.employer+o}}return{monthlyPAYE:0,annualPAYE:0,ssc_employee:0,ssc_employer:0,uif_employee:0,uif_employer:0,sdl:0,totalEmployeeDeductions:0,totalEmployerContributions:0}}function Ta(e){e.get("/api/super-admin/companies",async t=>{try{const{results:r}=await t.env.DB.prepare(`
        SELECT c.*, 
               COUNT(DISTINCT u.id) as employee_count,
               COUNT(DISTINCT fy.id) as financial_years
        FROM companies c
        LEFT JOIN users u ON c.id = u.company_id AND u.is_active = 1
        LEFT JOIN financial_years fy ON c.id = fy.company_id
        GROUP BY c.id
        ORDER BY c.company_type DESC, c.created_at DESC
      `).all();return t.json({companies:r})}catch{return t.json({error:"Failed to fetch companies"},500)}}),e.get("/api/super-admin/stats",async t=>{try{const r=await t.env.DB.prepare('SELECT COUNT(*) as count FROM companies WHERE company_type = "company"').first(),n=await t.env.DB.prepare('SELECT COUNT(*) as count FROM users WHERE is_active = 1 AND role != "super_admin"').first(),a=await t.env.DB.prepare('SELECT COUNT(*) as count FROM financial_years WHERE status = "active"').first(),s=await t.env.DB.prepare('SELECT COUNT(*) as count FROM year_end_processes WHERE status IN ("pending", "in_progress")').first();return t.json({stats:{total_companies:(r==null?void 0:r.count)||0,total_employees:(n==null?void 0:n.count)||0,active_financial_years:(a==null?void 0:a.count)||0,pending_year_end_processes:(s==null?void 0:s.count)||0}})}catch{return t.json({error:"Failed to fetch statistics"},500)}}),e.post("/api/super-admin/companies",async t=>{try{const r=await t.req.json(),a=(await t.env.DB.prepare(`
        INSERT INTO companies (
          name, organization_name, country, tax_regime, company_type,
          registration_number, address, contact_email, contact_phone,
          financial_year_end, current_financial_year
        ) VALUES (?, ?, ?, ?, 'company', ?, ?, ?, ?, ?, ?)
      `).bind(r.name,"TuloTech Africa",r.country||"Namibia",r.tax_regime||r.country||"Namibia",r.registration_number,r.address,r.contact_email,r.contact_phone,r.financial_year_end||"12-31",r.current_financial_year||new Date().getFullYear()).run()).meta.last_row_id;return await t.env.DB.prepare(`
        INSERT INTO financial_years (company_id, year, start_date, end_date, status)
        VALUES (?, ?, ?, ?, 'active')
      `).bind(a,r.current_financial_year||new Date().getFullYear(),`${r.current_financial_year||new Date().getFullYear()}-01-01`,`${r.current_financial_year||new Date().getFullYear()}-${r.financial_year_end||"12-31"}`).run(),t.json({success:!0,id:a})}catch{return t.json({error:"Failed to create company"},500)}}),e.put("/api/super-admin/companies/:id",async t=>{try{const r=t.req.param("id"),n=await t.req.json();return await t.env.DB.prepare(`
        UPDATE companies SET
          name = ?, country = ?, tax_regime = ?, registration_number = ?,
          address = ?, contact_email = ?, contact_phone = ?,
          updated_at = CURRENT_TIMESTAMP
        WHERE id = ?
      `).bind(n.name,n.country,n.tax_regime,n.registration_number,n.address,n.contact_email,n.contact_phone,r).run(),t.json({success:!0})}catch{return t.json({error:"Failed to update company"},500)}}),e.get("/api/super-admin/audit-logs",async t=>{try{const r=t.req.query("company_id"),n=parseInt(t.req.query("limit")||"100");let a=`
        SELECT al.*, u.first_name, u.last_name, u.email, c.name as company_name
        FROM audit_logs al
        JOIN users u ON al.user_id = u.id
        LEFT JOIN companies c ON al.company_id = c.id
        WHERE 1=1
      `;const s=[];r&&(a+=" AND al.company_id = ?",s.push(r)),a+=" ORDER BY al.created_at DESC LIMIT ?",s.push(n);const{results:i}=await t.env.DB.prepare(a).bind(...s).all();return t.json({logs:i})}catch{return t.json({error:"Failed to fetch audit logs"},500)}}),e.post("/api/tax/calculate",async t=>{try{const{monthly_salary:r,country:n,annual_bonuses:a}=await t.req.json(),s=Pr(parseFloat(r),n,parseFloat(a||0));return t.json({success:!0,calculations:s})}catch{return t.json({error:"Failed to calculate tax"},500)}}),e.get("/api/tax/configuration/:companyId",async t=>{try{const r=t.req.param("companyId"),n=t.req.query("year")||new Date().getFullYear(),a=await t.env.DB.prepare(`
        SELECT * FROM tax_configurations
        WHERE company_id = ? AND tax_year = ? AND is_active = 1
      `).bind(r,n).first();return t.json({config:a})}catch{return t.json({error:"Failed to fetch tax configuration"},500)}}),e.get("/api/financial-years",async t=>{try{const r=t.req.query("company_id"),{results:n}=await t.env.DB.prepare(`
        SELECT fy.*, u.first_name as closed_by_name, u.last_name as closed_by_surname
        FROM financial_years fy
        LEFT JOIN users u ON fy.closed_by = u.id
        WHERE fy.company_id = ?
        ORDER BY fy.year DESC
      `).bind(r).all();return t.json({financial_years:n})}catch{return t.json({error:"Failed to fetch financial years"},500)}}),e.post("/api/financial-years/:id/close",async t=>{try{const r=t.req.param("id"),{closed_by:n}=await t.req.json(),a=new Date().toISOString();return await t.env.DB.prepare(`
        UPDATE financial_years SET
          status = 'closed',
          closed_date = ?,
          closed_by = ?
        WHERE id = ?
      `).bind(a,n,r).run(),t.json({success:!0})}catch{return t.json({error:"Failed to close financial year"},500)}}),e.get("/api/year-end/processes",async t=>{try{const r=t.req.query("company_id"),{results:n}=await t.env.DB.prepare(`
        SELECT yep.*, 
               fy.year as financial_year,
               u1.first_name as initiated_by_name, u1.last_name as initiated_by_surname,
               u2.first_name as completed_by_name, u2.last_name as completed_by_surname
        FROM year_end_processes yep
        JOIN financial_years fy ON yep.financial_year_id = fy.id
        JOIN users u1 ON yep.initiated_by = u1.id
        LEFT JOIN users u2 ON yep.completed_by = u2.id
        WHERE yep.company_id = ?
        ORDER BY yep.initiated_at DESC
      `).bind(r).all();return t.json({processes:n})}catch{return t.json({error:"Failed to fetch year-end processes"},500)}}),e.post("/api/year-end/processes",async t=>{try{const r=await t.req.json(),n=await t.env.DB.prepare(`
        INSERT INTO year_end_processes (
          company_id, financial_year_id, process_type, initiated_by, notes
        ) VALUES (?, ?, ?, ?, ?)
      `).bind(r.company_id,r.financial_year_id,r.process_type,r.initiated_by,r.notes||"").run();return t.json({success:!0,id:n.meta.last_row_id})}catch{return t.json({error:"Failed to initiate year-end process"},500)}}),e.post("/api/year-end/processes/:id/complete",async t=>{try{const r=t.req.param("id"),{completed_by:n,result_summary:a}=await t.req.json(),s=new Date().toISOString();return await t.env.DB.prepare(`
        UPDATE year_end_processes SET
          status = 'completed',
          completed_at = ?,
          completed_by = ?,
          result_summary = ?
        WHERE id = ?
      `).bind(s,n,a,r).run(),t.json({success:!0})}catch{return t.json({error:"Failed to complete year-end process"},500)}}),e.get("/api/leave-balances",async t=>{try{const r=t.req.query("user_id"),n=t.req.query("company_id"),a=t.req.query("year")||new Date().getFullYear();let s="SELECT * FROM leave_balances WHERE 1=1";const i=[];r&&(s+=" AND user_id = ?",i.push(r)),n&&(s+=" AND company_id = ?",i.push(n)),a&&(s+=" AND year = ?",i.push(a));const{results:o}=await t.env.DB.prepare(s).bind(...i).all();return t.json({balances:o})}catch{return t.json({error:"Failed to fetch leave balances"},500)}}),e.post("/api/leave-balances/rollover",async t=>{try{const{company_id:r,from_year:n,to_year:a,max_carryover:s}=await t.req.json(),{results:i}=await t.env.DB.prepare(`
        SELECT * FROM leave_balances WHERE company_id = ? AND year = ?
      `).bind(r,n).all();for(const o of i){const c=Math.min(o.closing_balance||0,s||999999);await t.env.DB.prepare(`
          INSERT OR REPLACE INTO leave_balances (
            user_id, company_id, year, leave_type,
            opening_balance, accrued, taken, carried_forward, closing_balance
          ) VALUES (?, ?, ?, ?, ?, 0, 0, ?, ?)
        `).bind(o.user_id,r,a,o.leave_type,c,c,c).run()}return t.json({success:!0,rolled_over:i.length})}catch{return t.json({error:"Failed to rollover leave balances"},500)}}),e.get("/api/salary-history",async t=>{try{const r=t.req.query("user_id"),{results:n}=await t.env.DB.prepare(`
        SELECT sh.*, u.first_name as approved_by_name, u.last_name as approved_by_surname
        FROM salary_history sh
        LEFT JOIN users u ON sh.approved_by = u.id
        WHERE sh.user_id = ?
        ORDER BY sh.effective_date DESC
      `).bind(r).all();return t.json({history:n})}catch{return t.json({error:"Failed to fetch salary history"},500)}}),e.post("/api/salary-history",async t=>{try{const r=await t.req.json(),n=(r.new_salary-r.old_salary)/r.old_salary*100,a=await t.env.DB.prepare(`
        INSERT INTO salary_history (
          user_id, company_id, effective_date, old_salary, new_salary,
          change_percentage, change_reason, approved_by, notes
        ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)
      `).bind(r.user_id,r.company_id,r.effective_date,r.old_salary,r.new_salary,n,r.change_reason,r.approved_by,r.notes).run();return await t.env.DB.prepare(`
        UPDATE users SET salary = ?, updated_at = CURRENT_TIMESTAMP WHERE id = ?
      `).bind(r.new_salary,r.user_id).run(),t.json({success:!0,id:a.meta.last_row_id})}catch{return t.json({error:"Failed to add salary change"},500)}})}const R=new Tr;R.use("/static/*",Jn({root:"./"}));R.use(Ea);R.use("/api/*",Ln());Ta(R);R.post("/api/auth/login",async e=>{try{const{email:t,password:r}=await e.req.json(),n=await e.env.DB.prepare("SELECT * FROM users WHERE email = ? AND password_hash = ? AND is_active = 1").bind(t,r).first();if(!n)return e.json({error:"Invalid credentials"},401);const a=await e.env.DB.prepare("SELECT * FROM companies WHERE id = ?").bind(n.company_id).first();return e.json({success:!0,user:{id:n.id,email:n.email,first_name:n.first_name,last_name:n.last_name,role:n.role,company_id:n.company_id,company_name:a==null?void 0:a.name,organization_name:a==null?void 0:a.organization_name,employee_id:n.employee_id,department:n.department,position:n.position}})}catch{return e.json({error:"Login failed"},500)}});R.get("/api/companies",async e=>{try{const{results:t}=await e.env.DB.prepare("SELECT * FROM companies ORDER BY created_at DESC").all();return e.json({companies:t})}catch{return e.json({error:"Failed to fetch companies"},500)}});R.post("/api/companies",async e=>{try{const t=await e.req.json(),r=await e.env.DB.prepare(`
      INSERT INTO companies (name, organization_name, registration_number, address, contact_email, contact_phone)
      VALUES (?, ?, ?, ?, ?, ?)
    `).bind(t.name,t.organization_name||"TuloTech Africa",t.registration_number,t.address,t.contact_email,t.contact_phone).run();return e.json({success:!0,id:r.meta.last_row_id})}catch{return e.json({error:"Failed to create company"},500)}});R.get("/api/users",async e=>{try{const t=e.req.query("company_id"),r=e.req.query("role");let n="SELECT u.*, c.name as company_name FROM users u LEFT JOIN companies c ON u.company_id = c.id WHERE 1=1";const a=[];t&&(n+=" AND u.company_id = ?",a.push(t)),r&&(n+=" AND u.role = ?",a.push(r)),n+=" ORDER BY u.created_at DESC";const{results:s}=await e.env.DB.prepare(n).bind(...a).all();return e.json({users:s})}catch{return e.json({error:"Failed to fetch users"},500)}});R.get("/api/users/:id",async e=>{try{const t=e.req.param("id"),r=await e.env.DB.prepare("SELECT u.*, c.name as company_name FROM users u LEFT JOIN companies c ON u.company_id = c.id WHERE u.id = ?").bind(t).first();return r?e.json({user:r}):e.json({error:"User not found"},404)}catch{return e.json({error:"Failed to fetch user"},500)}});R.post("/api/users",async e=>{try{const t=await e.req.json(),r=await e.env.DB.prepare(`
      INSERT INTO users (company_id, email, password_hash, first_name, last_name, role, employee_id, department, position, hire_date, salary, phone, address)
      VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
    `).bind(t.company_id,t.email,t.password||"staff123",t.first_name,t.last_name,t.role||"staff",t.employee_id,t.department,t.position,t.hire_date,t.salary,t.phone,t.address).run();return e.json({success:!0,id:r.meta.last_row_id})}catch{return e.json({error:"Failed to create user"},500)}});R.put("/api/users/:id",async e=>{try{const t=e.req.param("id"),r=await e.req.json();return await e.env.DB.prepare(`
      UPDATE users SET 
        first_name = ?, last_name = ?, department = ?, position = ?, 
        salary = ?, phone = ?, address = ?, updated_at = CURRENT_TIMESTAMP
      WHERE id = ?
    `).bind(r.first_name,r.last_name,r.department,r.position,r.salary,r.phone,r.address,t).run(),e.json({success:!0})}catch{return e.json({error:"Failed to update user"},500)}});R.get("/api/attendance",async e=>{try{const t=e.req.query("user_id"),r=e.req.query("company_id"),n=e.req.query("date"),a=e.req.query("month");let s=`
      SELECT a.*, u.first_name, u.last_name, u.employee_id, u.department 
      FROM attendance a 
      JOIN users u ON a.user_id = u.id 
      WHERE 1=1
    `;const i=[];t&&(s+=" AND a.user_id = ?",i.push(t)),r&&(s+=" AND a.company_id = ?",i.push(r)),n&&(s+=" AND a.date = ?",i.push(n)),a&&(s+=' AND strftime("%Y-%m", a.date) = ?',i.push(a)),s+=" ORDER BY a.date DESC, a.clock_in DESC";const{results:o}=await e.env.DB.prepare(s).bind(...i).all();return e.json({attendance:o})}catch{return e.json({error:"Failed to fetch attendance"},500)}});R.post("/api/attendance/clock-in",async e=>{try{const{user_id:t,company_id:r}=await e.req.json(),n=new Date().toISOString().split("T")[0];if(await e.env.DB.prepare("SELECT * FROM attendance WHERE user_id = ? AND date = ?").bind(t,n).first())return e.json({error:"Already clocked in today"},400);const s=new Date().toISOString(),i=await e.env.DB.prepare(`
      INSERT INTO attendance (user_id, company_id, date, clock_in, status)
      VALUES (?, ?, ?, ?, 'present')
    `).bind(t,r,n,s).run();return e.json({success:!0,id:i.meta.last_row_id,clock_in:s})}catch{return e.json({error:"Failed to clock in"},500)}});R.post("/api/attendance/clock-out",async e=>{try{const{user_id:t}=await e.req.json(),r=new Date().toISOString().split("T")[0],n=new Date().toISOString();return(await e.env.DB.prepare(`
      UPDATE attendance SET clock_out = ?, updated_at = CURRENT_TIMESTAMP
      WHERE user_id = ? AND date = ?
    `).bind(n,t,r).run()).meta.changes===0?e.json({error:"No clock-in record found for today"},400):e.json({success:!0,clock_out:n})}catch{return e.json({error:"Failed to clock out"},500)}});R.post("/api/attendance",async e=>{try{const t=await e.req.json(),r=await e.env.DB.prepare(`
      INSERT INTO attendance (user_id, company_id, date, clock_in, clock_out, status, notes)
      VALUES (?, ?, ?, ?, ?, ?, ?)
    `).bind(t.user_id,t.company_id,t.date,t.clock_in,t.clock_out,t.status,t.notes).run();return e.json({success:!0,id:r.meta.last_row_id})}catch{return e.json({error:"Failed to create attendance record"},500)}});R.get("/api/payslips",async e=>{try{const t=e.req.query("user_id"),r=e.req.query("company_id"),n=e.req.query("year"),a=e.req.query("month");let s=`
      SELECT p.*, u.first_name, u.last_name, u.employee_id, u.department, u.position
      FROM payslips p
      JOIN users u ON p.user_id = u.id
      WHERE 1=1
    `;const i=[];t&&(s+=" AND p.user_id = ?",i.push(t)),r&&(s+=" AND p.company_id = ?",i.push(r)),n&&(s+=" AND p.year = ?",i.push(n)),a&&(s+=" AND p.month = ?",i.push(a)),s+=" ORDER BY p.year DESC, p.month DESC";const{results:o}=await e.env.DB.prepare(s).bind(...i).all();return e.json({payslips:o})}catch{return e.json({error:"Failed to fetch payslips"},500)}});R.get("/api/payslips/:id",async e=>{try{const t=e.req.param("id"),r=await e.env.DB.prepare(`
      SELECT p.*, u.first_name, u.last_name, u.employee_id, u.department, u.position, u.phone, u.address,
             c.name as company_name, c.organization_name, c.address as company_address, c.contact_email, c.contact_phone
      FROM payslips p
      JOIN users u ON p.user_id = u.id
      JOIN companies c ON p.company_id = c.id
      WHERE p.id = ?
    `).bind(t).first();return r?e.json({payslip:r}):e.json({error:"Payslip not found"},404)}catch{return e.json({error:"Failed to fetch payslip"},500)}});R.post("/api/payslips",async e=>{try{const t=await e.req.json(),r=await e.env.DB.prepare("SELECT country FROM companies WHERE id = ?").bind(t.company_id).first(),n=(r==null?void 0:r.country)||"Namibia",a=parseFloat(t.basic_salary)+parseFloat(t.allowances||0)+parseFloat(t.bonuses||0)+parseFloat(t.overtime_pay||0);let s=parseFloat(t.tax_deduction||0),i=0,o=0;if(t.auto_calculate_tax){const f=Pr(parseFloat(t.basic_salary),n,parseFloat(t.bonuses||0));s=f.monthlyPAYE,n==="Namibia"?i=f.ssc_employee:n==="South Africa"&&(o=f.uif_employee)}const c=s+i+o+parseFloat(t.insurance_deduction||0)+parseFloat(t.pension_deduction||0)+parseFloat(t.other_deductions||0),l=a-c,d=await e.env.DB.prepare(`
      INSERT INTO payslips (
        user_id, company_id, month, year, basic_salary, allowances, bonuses, 
        overtime_hours, overtime_pay, gross_salary, tax_deduction, insurance_deduction,
        pension_deduction, other_deductions, total_deductions, net_salary, 
        payment_date, payment_method, bank_account, notes, generated_by
      ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
    `).bind(t.user_id,t.company_id,t.month,t.year,t.basic_salary,t.allowances||0,t.bonuses||0,t.overtime_hours||0,t.overtime_pay||0,a,s,t.insurance_deduction||0,t.pension_deduction||0,t.other_deductions||0,c,l,t.payment_date,t.payment_method,t.bank_account,t.notes,t.generated_by).run();return e.json({success:!0,id:d.meta.last_row_id,gross_salary:a,tax_deduction:s,ssc_deduction:i,uif_deduction:o,total_deductions:c,net_salary:l})}catch{return e.json({error:"Failed to create payslip"},500)}});R.get("/api/leave-requests",async e=>{try{const t=e.req.query("user_id"),r=e.req.query("company_id"),n=e.req.query("status");let a=`
      SELECT lr.*, u.first_name, u.last_name, u.employee_id, u.department,
             approver.first_name as approver_first_name, approver.last_name as approver_last_name
      FROM leave_requests lr
      JOIN users u ON lr.user_id = u.id
      LEFT JOIN users approver ON lr.approved_by = approver.id
      WHERE 1=1
    `;const s=[];t&&(a+=" AND lr.user_id = ?",s.push(t)),r&&(a+=" AND lr.company_id = ?",s.push(r)),n&&(a+=" AND lr.status = ?",s.push(n)),a+=" ORDER BY lr.created_at DESC";const{results:i}=await e.env.DB.prepare(a).bind(...s).all();return e.json({leave_requests:i})}catch{return e.json({error:"Failed to fetch leave requests"},500)}});R.post("/api/leave-requests",async e=>{try{const t=await e.req.json(),r=new Date(t.start_date),n=new Date(t.end_date),a=Math.ceil((n.getTime()-r.getTime())/(1e3*60*60*24))+1,s=await e.env.DB.prepare(`
      INSERT INTO leave_requests (user_id, company_id, leave_type, start_date, end_date, days_count, reason)
      VALUES (?, ?, ?, ?, ?, ?, ?)
    `).bind(t.user_id,t.company_id,t.leave_type,t.start_date,t.end_date,a,t.reason).run();return e.json({success:!0,id:s.meta.last_row_id,days_count:a})}catch{return e.json({error:"Failed to create leave request"},500)}});R.put("/api/leave-requests/:id",async e=>{try{const t=e.req.param("id"),r=await e.req.json(),n=new Date().toISOString();return await e.env.DB.prepare(`
      UPDATE leave_requests SET 
        status = ?, approved_by = ?, approved_at = ?, notes = ?, updated_at = CURRENT_TIMESTAMP
      WHERE id = ?
    `).bind(r.status,r.approved_by,n,r.notes,t).run(),e.json({success:!0})}catch{return e.json({error:"Failed to update leave request"},500)}});R.get("/api/calendar-events",async e=>{try{const t=e.req.query("company_id"),r=e.req.query("month");let n=`
      SELECT ce.*, u.first_name as organizer_first_name, u.last_name as organizer_last_name
      FROM calendar_events ce
      LEFT JOIN users u ON ce.organizer_id = u.id
      WHERE 1=1
    `;const a=[];t&&(n+=" AND ce.company_id = ?",a.push(t)),r&&(n+=' AND strftime("%Y-%m", ce.start_date) = ?',a.push(r)),n+=" ORDER BY ce.start_date ASC";const{results:s}=await e.env.DB.prepare(n).bind(...a).all();return e.json({events:s})}catch{return e.json({error:"Failed to fetch calendar events"},500)}});R.post("/api/calendar-events",async e=>{try{const t=await e.req.json(),r=await e.env.DB.prepare(`
      INSERT INTO calendar_events (
        company_id, title, description, event_type, start_date, end_date, 
        is_all_day, location, organizer_id, is_public, color
      ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
    `).bind(t.company_id,t.title,t.description,t.event_type,t.start_date,t.end_date,t.is_all_day?1:0,t.location,t.organizer_id,t.is_public!==!1?1:0,t.color||"#3B82F6").run();return e.json({success:!0,id:r.meta.last_row_id})}catch{return e.json({error:"Failed to create calendar event"},500)}});R.delete("/api/calendar-events/:id",async e=>{try{const t=e.req.param("id");return await e.env.DB.prepare("DELETE FROM calendar_events WHERE id = ?").bind(t).run(),e.json({success:!0})}catch{return e.json({error:"Failed to delete calendar event"},500)}});R.get("/api/messages",async e=>{try{const t=e.req.query("user_id"),r=e.req.query("company_id"),n=e.req.query("announcement");let a=`
      SELECT m.*, 
             sender.first_name as sender_first_name, sender.last_name as sender_last_name,
             recipient.first_name as recipient_first_name, recipient.last_name as recipient_last_name
      FROM messages m
      JOIN users sender ON m.sender_id = sender.id
      LEFT JOIN users recipient ON m.recipient_id = recipient.id
      WHERE 1=1
    `;const s=[];r&&(a+=" AND m.company_id = ?",s.push(r)),n==="true"?a+=" AND m.is_announcement = 1":t&&(a+=" AND (m.recipient_id = ? OR m.sender_id = ? OR m.is_announcement = 1)",s.push(t,t)),a+=" ORDER BY m.created_at DESC";const{results:i}=await e.env.DB.prepare(a).bind(...s).all();return e.json({messages:i})}catch{return e.json({error:"Failed to fetch messages"},500)}});R.post("/api/messages",async e=>{try{const t=await e.req.json(),r=await e.env.DB.prepare(`
      INSERT INTO messages (
        company_id, sender_id, recipient_id, subject, message, 
        is_announcement, priority
      ) VALUES (?, ?, ?, ?, ?, ?, ?)
    `).bind(t.company_id,t.sender_id,t.recipient_id||null,t.subject,t.message,t.is_announcement?1:0,t.priority||"normal").run();return e.json({success:!0,id:r.meta.last_row_id})}catch{return e.json({error:"Failed to send message"},500)}});R.put("/api/messages/:id/read",async e=>{try{const t=e.req.param("id"),r=new Date().toISOString();return await e.env.DB.prepare(`
      UPDATE messages SET is_read = 1, read_at = ? WHERE id = ?
    `).bind(r,t).run(),e.json({success:!0})}catch{return e.json({error:"Failed to mark message as read"},500)}});R.get("/api/announcements",async e=>{try{const t=e.req.query("company_id");let r=`
      SELECT a.*, u.first_name, u.last_name
      FROM announcements a
      JOIN users u ON a.posted_by = u.id
      WHERE a.is_active = 1
    `;const n=[];t&&(r+=" AND a.company_id = ?",n.push(t)),r+=' AND (a.expires_at IS NULL OR a.expires_at > datetime("now"))',r+=" ORDER BY a.priority DESC, a.created_at DESC";const{results:a}=await e.env.DB.prepare(r).bind(...n).all();return e.json({announcements:a})}catch{return e.json({error:"Failed to fetch announcements"},500)}});R.post("/api/announcements",async e=>{try{const t=await e.req.json(),r=await e.env.DB.prepare(`
      INSERT INTO announcements (company_id, title, content, category, priority, posted_by, expires_at)
      VALUES (?, ?, ?, ?, ?, ?, ?)
    `).bind(t.company_id,t.title,t.content,t.category,t.priority||"normal",t.posted_by,t.expires_at||null).run();return e.json({success:!0,id:r.meta.last_row_id})}catch{return e.json({error:"Failed to create announcement"},500)}});R.get("/api/policy-documents",async e=>{try{const t=e.req.query("company_id");let r=`
      SELECT pd.id, pd.company_id, pd.title, pd.description, pd.category, 
             pd.file_type, pd.file_size, pd.version, pd.is_active, pd.created_at,
             u.first_name, u.last_name
      FROM policy_documents pd
      LEFT JOIN users u ON pd.uploaded_by = u.id
      WHERE pd.is_active = 1
    `;const n=[];t&&(r+=" AND pd.company_id = ?",n.push(t)),r+=" ORDER BY pd.created_at DESC";const{results:a}=await e.env.DB.prepare(r).bind(...n).all();return e.json({documents:a})}catch{return e.json({error:"Failed to fetch policy documents"},500)}});R.get("/api/policy-documents/:id",async e=>{try{const t=e.req.param("id"),r=await e.env.DB.prepare("SELECT * FROM policy_documents WHERE id = ? AND is_active = 1").bind(t).first();return r?e.json({document:r}):e.json({error:"Document not found"},404)}catch{return e.json({error:"Failed to fetch document"},500)}});R.get("/api/achievements",async e=>{try{const t=e.req.query("user_id"),r=e.req.query("company_id");let n=`
      SELECT a.*, u.first_name, u.last_name, u.employee_id,
             awarder.first_name as awarder_first_name, awarder.last_name as awarder_last_name
      FROM achievements a
      JOIN users u ON a.user_id = u.id
      LEFT JOIN users awarder ON a.awarded_by = awarder.id
      WHERE 1=1
    `;const a=[];t&&(n+=" AND a.user_id = ?",a.push(t)),r&&(n+=" AND a.company_id = ?",a.push(r)),n+=" ORDER BY a.created_at DESC";const{results:s}=await e.env.DB.prepare(n).bind(...a).all();return e.json({achievements:s})}catch{return e.json({error:"Failed to fetch achievements"},500)}});R.post("/api/achievements",async e=>{try{const t=await e.req.json(),r=await e.env.DB.prepare(`
      INSERT INTO achievements (user_id, company_id, achievement_type, title, description, icon, points, awarded_by)
      VALUES (?, ?, ?, ?, ?, ?, ?, ?)
    `).bind(t.user_id,t.company_id,t.achievement_type,t.title,t.description,t.icon||"",t.points||0,t.awarded_by).run();return e.json({success:!0,id:r.meta.last_row_id})}catch{return e.json({error:"Failed to create achievement"},500)}});R.get("/api/motivational-quote",async e=>{try{const{results:t}=await e.env.DB.prepare("SELECT * FROM motivational_quotes WHERE is_active = 1 ORDER BY RANDOM() LIMIT 1").all();return e.json({quote:t[0]||null})}catch{return e.json({error:"Failed to fetch quote"},500)}});R.get("/api/stats/dashboard",async e=>{try{const t=e.req.query("company_id"),r=e.req.query("user_id");if(!t)return e.json({error:"Company ID required"},400);const n=await e.env.DB.prepare('SELECT COUNT(*) as count FROM users WHERE company_id = ? AND is_active = 1 AND role = "staff"').bind(t).first(),a=new Date().toISOString().split("T")[0],s=await e.env.DB.prepare('SELECT COUNT(*) as count FROM attendance WHERE company_id = ? AND date = ? AND status = "present"').bind(t,a).first(),i=await e.env.DB.prepare('SELECT COUNT(*) as count FROM leave_requests WHERE company_id = ? AND status = "pending"').bind(t).first(),o=await e.env.DB.prepare('SELECT COUNT(*) as count FROM calendar_events WHERE company_id = ? AND start_date > datetime("now")').bind(t).first();return e.json({stats:{total_employees:(n==null?void 0:n.count)||0,present_today:(s==null?void 0:s.count)||0,pending_leaves:(i==null?void 0:i.count)||0,upcoming_events:(o==null?void 0:o.count)||0}})}catch{return e.json({error:"Failed to fetch statistics"},500)}});R.get("/",e=>e.render(F("div",{id:"app",class:"min-h-screen"})));const Vt=new Tr,xa=Object.assign({"/src/index.tsx":R});let Lr=!1;for(const[,e]of Object.entries(xa))e&&(Vt.all("*",t=>{let r;try{r=t.executionCtx}catch{}return e.fetch(t.req.raw,t.env,r)}),Vt.notFound(t=>{let r;try{r=t.executionCtx}catch{}return e.fetch(t.req.raw,t.env,r)}),Lr=!0);if(!Lr)throw new Error("Can't import modules from ['/src/index.ts','/src/index.tsx','/app/server.ts']");export{Vt as default};
